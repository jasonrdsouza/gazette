{
    "articles": [
        {
            "content": [
                "<p>When I started building Bear I made the code available under an <a href=\"https://opensource.org/license/mit\" target=\"_blank\">MIT license</a>. I didn't give it much thought at the time, but knew that I wanted the code to be available for people to learn from, and to make it easily auditable so users could validate claims I have made about the privacy and security of the platform.</p>\n<p>Unfortunately over the years there have been cases of people forking the project in the attempt to set up a competing service. And it hurts. It hurts to see something you've worked so hard on for so long get copied and distributed with only a few hours of modification. It hurts to have poured so much love into a piece of software to see it turned against you and threaten your livelihood. It hurts to believe in open-source and then be bitten by it.</p>\n<p>After the last instance of this I have come to the difficult decision to change Bear's license from MIT to a version of copyleft called the Elastic License\u2014created by the Elastic Search people.</p>\n<p>This license is almost identical to the MIT license but with the stipulation that the software cannot be provided as a hosted or managed service. You can view the specific wording <a href=\"https://github.com/HermanMartinus/bearblog/blob/master/LICENSE.md\" target=\"_blank\">here</a>.</p>\n<p>After spending time researching how other projects are handling this, I realise I'm not alone. Many other open-source projects have updated their licenses to prevent \"free-ride competition\" in the past few years.<sup><a href=\"https://plausible.io/blog/open-source-licenses\" target=\"_blank\">1</a><a href=\"https://github.com/usefathom/fathom\" target=\"_blank\">2</a><a href=\"https://grafana.com/blog/2021/04/20/grafana-loki-tempo-relicensing-to-agplv3/\" target=\"_blank\">3</a><a href=\"https://snowplow.io/blog/introducing-snowplow-limited-use-license\" target=\"_blank\">4</a><a href=\"https://www.scylladb.com/2024/12/18/why-were-moving-to-a-source-available-license/\" target=\"_blank\">5</a><a href=\"https://blog.sentry.io/introducing-the-functional-source-license-freedom-without-free-riding/\" target=\"_blank\">6</a></sup></p>\n<p>We're entering a new age of AI powered coding, where creating a competing product only involves typing \"Create a fork of this repo and change its name to something cool and deploy it on an EC2 instance\".</p>\n<p>While Bear's code is good, what makes the platform special is the <a href=\"https://bearblog.dev/discover/\" target=\"_blank\">people who use it</a>, and the <a href=\"https://herman.bearblog.dev/manifesto/\" target=\"_blank\">commitment to longevity</a>.</p>\n<p>I will ensure the platform is taken care of, even if it means backtracking on what people can do with the code itself.</p>"
            ],
            "link": "https://herman.bearblog.dev/license/",
            "publishedAt": "2025-09-01",
            "source": "Herman Martinus",
            "summary": "<p>When I started building Bear I made the code available under an <a href=\"https://opensource.org/license/mit\" target=\"_blank\">MIT license</a>. I didn't give it much thought at the time, but knew that I wanted the code to be available for people to learn from, and to make it easily auditable so users could validate claims I have made about the privacy and security of the platform.</p> <p>Unfortunately over the years there have been cases of people forking the project in the attempt to set up a competing service. And it hurts. It hurts to see something you've worked so hard on for so long get copied and distributed with only a few hours of modification. It hurts to have poured so much love into a piece of software to see it turned against you and threaten your livelihood. It hurts to believe in open-source and then be bitten by it.</p> <p>After the last instance of this I have come to the difficult decision to change Bear's license from MIT to a version of copyleft called the Elastic License\u2014created by the Elastic Search people.</p> <p>This license is almost identical to the MIT license but with the stipulation that the software cannot be provided as a",
            "title": "Bear is now source-available"
        },
        {
            "content": [
                "<figure><img alt=\"\" src=\"https://www.jonashietala.se/images/hue_tap_dial.jpg\" />\n</figure>\n<p>I recently bought a couple of <a href=\"https://www.philips-hue.com/sv-se/p/hue-tap-dial-switch/8719514440999\">Hue Tap Dial</a> switches for our house to enhance our smart home.\nWe have quite a few smart lights and I figured <a href=\"https://www.philips-hue.com/sv-se/p/hue-tap-dial-switch/8719514440999\">the tap dial</a>\u2014with it\u2019s multiple buttons and rotary dial\u2014would be a good fit.</p>\n<p>Since I\u2019ve been moving away from standard Home Assistant automations to <a href=\"https://www.jonashietala.se/blog/2024/10/08/writing_home_assistant_automations_using_genservers_in_elixir/\">my own automation engine in Elixir</a> I had to figure out how best to integrate the tap dial.</p>\n<p>At first I tried to rely on my existing <a href=\"https://www.home-assistant.io/\">Home Assistant</a> connection but I realized that it\u2019s better to bypass <a href=\"https://www.home-assistant.io/\">Home Assistant</a> and go directly via <a href=\"https://mqtt.org/\">MQTT</a>, as I already use <a href=\"https://www.zigbee2mqtt.io/\">Zigbee2MQTT</a> as the way to get Zigbee devices into <a href=\"https://www.home-assistant.io/\">Home Assistant</a>.</p>\n<p>This post walks through how I set it all up and I\u2019ll end up with an example of how I control multiple Zigbee lights from one dial via Elixir.</p>\n<aside class=\"tip\">\n<p>In the <a href=\"https://www.jonashietala.se/blog/2024/10/08/writing_home_assistant_automations_using_genservers_in_elixir/\">post about my automation engine</a> I demonstrated how I controlled lights from Elixir via <a href=\"https://www.home-assistant.io/\">Home Assistant</a> states and actions.\nFor the devices that supports it, it\u2019s better to communicate directly over <a href=\"https://mqtt.org/\">MQTT</a> as you\u2019ll get better latency and more features.\nSince then I\u2019ve converted over most of my automations to be <a href=\"https://mqtt.org/\">MQTT</a> based.</p>\n</aside>\n<section id=\"The-direct-zigbee-binding-is-good-but-not-great\">\n<h2><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#The-direct-zigbee-binding-is-good-but-not-great\">The direct zigbee binding is good but not great</a></h2>\n<p>I\u2019m a huge fan of using direct bindings in Zigbee to directly pair switches to lights.\nThis way the interaction is much snappier; instead of going through:</p>\n<div class=\"code-wrapper\"><pre><code><div class=\"line\">device 1 -> zigbee2mqtt -> controller -> zigbee2mqtt -> device 2\n</div></code></pre></div>\n<p>The communication can instead go:</p>\n<div class=\"code-wrapper\"><pre><code><div class=\"line\">device 1 -> device 2\n</div></code></pre></div>\n<p>It works if my server is down, which is a huge plus for important functionality such as turning on the light in the middle of the night when one of the kids have soiled the bed.\nThat\u2019s <em>not</em> the time you want to debug your homelab setup!</p>\n<p>The <a href=\"https://www.philips-hue.com/sv-se/p/hue-tap-dial-switch/8719514440999\">Hue Tap Dial</a> can be bound to lights with <a href=\"https://www.zigbee2mqtt.io/\">Zigbee2MQTT</a> and dimming the lights with the dial feels very smooth and nice.\nYou can also rotate the dial to turn on and off the light, like a normal dimmer switch.</p>\n<p>Unfortunately, if you want to bind the dimmer it also binds the hold of <em>all</em> of the four buttons to turn off the light, practically blocking the hold functionality if you use direct binding.\nThere\u2019s also no way to directly bind a button press to turn on or toggle the light\u2014dimming and hold to turn off is what you get.</p>\n<p>To add more functionality you have to use something external; a Hue Bridge or <a href=\"https://www.home-assistant.io/\">Home Assistant</a> with a Zigbee dongle works, but I wanted to use Elixir.</p>\n</section>\n<section id=\"Communicating-with-MQTT-in-Elixir\">\n<h2><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Communicating-with-MQTT-in-Elixir\">Communicating with MQTT in Elixir</a></h2>\n<p>The first thing we need to do is figure out is how to receive MQTT messages and how to send updates to Zigbee devices.</p>\n<aside class=\"note\">\n<p>I use <a href=\"https://www.zigbee2mqtt.io/\">Zigbee2MQTT</a> as the Zigbee to MQTT bridge and <a href=\"https://github.com/eclipse-mosquitto/mosquitto\">mosquitto</a> as my MQTT server.\nMessages may look different if you\u2019re using another setup.</p>\n</aside>\n<section id=\"Connecting-and-subscribing-to-changes\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Connecting-and-subscribing-to-changes\">Connecting and subscribing to changes</a></h3>\n<p>I found the <a href=\"https://hexdocs.pm/tortoise311/0.12.1/introduction.html\">tortoise311</a> library that implements an MQTT client and it was quite pleasant to use.</p>\n<p>First we\u2019ll start a <code>Tortoise311.Connection</code> in our main Supervisor tree:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"entity name class elixir\">Tortoise311</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">Connection</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\"> <span class=\"punctuation section array elixir\">[</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">   <span class=\"punctuation definition comment elixir\">#</span> Remember to generate a unique id if you want to connect multiple clients\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">   <span class=\"punctuation definition comment elixir\">#</span> to the same MQTT service.\n</div><div class=\"line\"></span>   <span class=\"constant other keywords elixir\">client_id<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>my_unique_client_id</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">   <span class=\"punctuation definition comment elixir\">#</span> They don't have to be on the same server.\n</div><div class=\"line\"></span>   <span class=\"constant other keywords elixir\">server<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"entity name class elixir\">Tortoise311</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">Transport</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">Tcp</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">host<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>localhost<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">port<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">1883</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">   <span class=\"punctuation definition comment elixir\">#</span> Messages will be sent to `Haex.MqttHandler`.\n</div><div class=\"line\"></span>   <span class=\"constant other keywords elixir\">handler<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"entity name class elixir\">Haex</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">MqttHandler</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"punctuation section array elixir\">[</span><span class=\"punctuation section array elixir\">]</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">   <span class=\"punctuation definition comment elixir\">#</span> Subscribe to all events under `zigbee2mqtt`.\n</div><div class=\"line\"></span>   <span class=\"constant other keywords elixir\">subscriptions<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"punctuation section array elixir\">[</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>zigbee2mqtt/+<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant numeric elixir\">0</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section array elixir\">]</span>\n</div><div class=\"line\"> <span class=\"punctuation section array elixir\">]</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span>\n</div></code></pre></div>\n<aside class=\"note\">\n<p>The <code>zigbee2mqtt</code> base topic is configurable in Zigbee2MQTT and you may need to tweak it for your setup.</p>\n</aside>\n<p>I\u2019ll also add <a href=\"https://hexdocs.pm/phoenix_pubsub/Phoenix.PubSub.html\">Phoenix PubSub</a> to the Supervisor, which we\u2019ll use to propagate MQTT messages to our automation:</p>\n<div class=\"code-wrapper\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"entity name class elixir\">Phoenix</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">PubSub</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">name<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"entity name class elixir\">Haex</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">PubSub</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span>\n</div></code></pre></div>\n<p>When starting <code>Tortoise311.Connection</code> above we configured it to call the <code>Haex.MqttHandler</code> whenever an MQTT message we\u2019re subscribing to is received.\nHere we\u2019ll simply forward any message to our PubSub, making it easy for anyone to subscribe to any message, wherever they are:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta module elixir\"><span class=\"keyword control module elixir\">defmodule</span> <span class=\"entity name class elixir\">Haex</span>.<span class=\"entity name class elixir\">MqttHandler</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">use</span> <span class=\"entity name class elixir\">Tortoise311</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">Handler</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">alias</span> <span class=\"entity name class elixir\">Phoenix</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">PubSub</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_message</span><span class=\"punctuation definition parameters elixir\">(</span>topic<span class=\"punctuation separator object elixir\">,</span> payload<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    payload <span class=\"keyword operator assignment elixir\">=</span> <span class=\"entity name class elixir\">Jason</span><span class=\"punctuation separator method elixir\">.</span>decode!<span class=\"punctuation section function elixir\">(</span>payload<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"entity name class elixir\">PubSub</span><span class=\"punctuation separator method elixir\">.</span>broadcast!<span class=\"punctuation section function elixir\">(</span><span class=\"entity name class elixir\">Haex</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">PubSub</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"entity name class elixir\">Enum</span><span class=\"punctuation separator method elixir\">.</span>join<span class=\"punctuation section function elixir\">(</span>topic<span class=\"punctuation separator object elixir\">,</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>/<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> topic<span class=\"punctuation separator sequence elixir\">,</span> payload<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>ok</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n<p>Then in our automation (which in <a href=\"https://www.jonashietala.se/blog/2024/10/08/writing_home_assistant_automations_using_genservers_in_elixir/\">my automation system</a> is a regular GenServer) we can subscribe to the events the Tap Dial creates:</p>\n<div class=\"code-wrapper\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta module elixir\"><span class=\"keyword control module elixir\">defmodule</span> <span class=\"entity name class elixir\">Automation</span>.<span class=\"entity name class elixir\">TapDialExample</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">use</span> <span class=\"entity name class elixir\">GenServer</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">alias</span> <span class=\"entity name class elixir\">Phoenix</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">PubSub</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  <span class=\"variable other module elixir\"><span class=\"keyword operator definition constant elixir\">@</span>impl</span> <span class=\"constant language elixir\">true</span>\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">init</span><span class=\"punctuation definition parameters elixir\">(</span>_opts<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> `My tap dial` is the name of the tap dial in zigbee2mqtt.\n</div><div class=\"line\"></span>    <span class=\"entity name class elixir\">PubSub</span><span class=\"punctuation separator method elixir\">.</span>subscribe<span class=\"punctuation section function elixir\">(</span><span class=\"entity name class elixir\">Haex</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">PubSub</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>zigbee2mqtt/My tap dial<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>ok</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  <span class=\"variable other module elixir\"><span class=\"keyword operator definition constant elixir\">@</span>impl</span> <span class=\"constant language elixir\">true</span>\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> payload<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    dbg<span class=\"punctuation section function elixir\">(</span>payload<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n<p>If everything is setup correctly we should see messages like these when we operate the Tap Dial:</p>\n<div class=\"code-wrapper\"><div class=\"descr\"></div><pre><code><div class=\"line\">payload #=> %{\n</div><div class=\"line\">  \"action\" => \"button_1_press_release\",\n</div><div class=\"line\">  ...\n</div><div class=\"line\">}\n</div><div class=\"line\">\n</div><div class=\"line\">payload #=> %{\n</div><div class=\"line\">  \"action\" => \"dial_rotate_right_step\",\n</div><div class=\"line\">  \"action_direction\" => \"right\",\n</div><div class=\"line\">  \"action_time\" => 15,\n</div><div class=\"line\">  \"action_type\" => \"step\",\n</div><div class=\"line\">  ...\n</div><div class=\"line\">}\n</div></code></pre></div>\n</section>\n<section id=\"Controlling-devices\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Controlling-devices\">Controlling devices</a></h3>\n<p>To change the state of a device we should send a json payload to the \u201cset\u201d topic.\nFor example, to turn off a light named <code>My hue light</code> we should send the payload \n<code class=\"highlight json\"><span class=\"meta structure dictionary json\"><span class=\"punctuation section dictionary begin json\">{</span><span class=\"meta structure dictionary key json\"><span class=\"string quoted double json\"><span class=\"punctuation definition string begin json\">&quot;</span>state<span class=\"punctuation definition string end json\">&quot;</span></span></span><span class=\"meta structure dictionary value json\"><span class=\"punctuation separator dictionary key-value json\">:</span> <span class=\"string quoted double json\"><span class=\"punctuation definition string begin json\">&quot;</span>OFF<span class=\"punctuation definition string end json\">&quot;</span></span></span><span class=\"punctuation section dictionary end json\">}</span></span></code> to <code>zigbee2mqtt/My hue light/set</code>.</p>\n<p>Here\u2019s a function to send payloads to our light:</p>\n<div class=\"code-wrapper\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">set</span><span class=\"punctuation definition parameters elixir\">(</span>payload<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  <span class=\"entity name class elixir\">Tortoise311</span><span class=\"punctuation separator method elixir\">.</span>publish<span class=\"punctuation section function elixir\">(</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> Important that this id matches the `client_id`\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> we gave to Tortoise311.Connection.\n</div><div class=\"line\"></span>    <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>my_unique_client_id</span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">    <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>zigbee2mqtt/My hue light/set<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">    <span class=\"entity name class elixir\">Jason</span><span class=\"punctuation separator method elixir\">.</span>encode!<span class=\"punctuation section function elixir\">(</span>payload<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n<aside class=\"note\">\n<p>The payloads and capabilities are different for each device; <a href=\"https://www.zigbee2mqtt.io/devices/9290024688.html\">here\u2019s the information</a> for the Hue light I\u2019m using in this example.</p>\n</aside>\n</section>\n</section>\n<section id=\"Button-presses\">\n<h2><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Button-presses\">Button presses</a></h2>\n<p>With the MQTT communication done, we can start writing some automations.</p>\n<section id=\"Normal-press\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Normal-press\">Normal press</a></h3>\n<p>Here\u2019s how we can toggle the light on/off when we click the first button on the dial in our GenServer:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>button_1_press_release<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">state<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>TOGGLE<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n<p>(Remember that we subscribed to the \n<code class=\"highlight elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>zigbee2mqtt/My tap dial<span class=\"punctuation definition string end elixir\">&quot;</span></span></span></code> topic during <code>init</code>.)</p>\n</section>\n<section id=\"Hold\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Hold\">Hold</a></h3>\n<p>You can also hold a button, which generates a <code>hold</code> and a <code>hold_release</code> event.\nHere\u2019s how to use them to start moving through the hues of a light when you hold down a button and stop when you release it.</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>button_3_hold<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue_move<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">40</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">color<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">saturation<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">100</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>button_3_hold_release<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue_move<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">0</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n</section>\n<section id=\"Double-clicking\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Double-clicking\">Double clicking</a></h3>\n<p>How about double clicking?<br />\nYou could track the timestamp of the presses in the GenServer state and check the duration between them to determine if it\u2019s a double click or not; maybe something like this:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>button_2_press_release<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  double_click_limit <span class=\"keyword operator assignment elixir\">=</span> <span class=\"constant numeric elixir\">350</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  now <span class=\"keyword operator assignment elixir\">=</span> <span class=\"entity name class elixir\">DateTime</span><span class=\"punctuation separator method elixir\">.</span>utc_now<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  <span class=\"keyword control elixir\">if</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator logical elixir\">&amp;&amp;</span>\n</div><div class=\"line\">       <span class=\"entity name class elixir\">DateTime</span><span class=\"punctuation separator method elixir\">.</span>diff<span class=\"punctuation section function elixir\">(</span>now<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section array elixir\">]</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>millisecond</span><span class=\"punctuation section function elixir\">)</span> <span class=\"keyword operator comparison elixir\">&lt;</span> double_click_limit <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> If we double clicked.\n</div><div class=\"line\"></span>    set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">color<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">60</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>delete<span class=\"punctuation section function elixir\">(</span>state<span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">else</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> If we single clicked.\n</div><div class=\"line\"></span>    set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">color<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">180</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>put<span class=\"punctuation section function elixir\">(</span>state<span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation separator sequence elixir\">,</span> now<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n<p>This however executes an action on the first and second click.\nTo get around that we could add a timeout for the first press by sending ourselves a delayed message, with the downside of introducing a small delay for single clicks:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>button_2_press_release<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  double_click_limit <span class=\"keyword operator assignment elixir\">=</span> <span class=\"constant numeric elixir\">350</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  now <span class=\"keyword operator assignment elixir\">=</span> <span class=\"entity name class elixir\">DateTime</span><span class=\"punctuation separator method elixir\">.</span>utc_now<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  <span class=\"keyword control elixir\">if</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator logical elixir\">&amp;&amp;</span>\n</div><div class=\"line\">       <span class=\"entity name class elixir\">DateTime</span><span class=\"punctuation separator method elixir\">.</span>diff<span class=\"punctuation section function elixir\">(</span>now<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section array elixir\">]</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>millisecond</span><span class=\"punctuation section function elixir\">)</span> <span class=\"keyword operator comparison elixir\">&lt;</span> double_click_limit <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">    set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">color<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">180</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> The double click clause is the same as before except we also remove `click_ref`\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> to signify that we've handled the interaction as a double click.\n</div><div class=\"line\"></span>    state <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">      state\n</div><div class=\"line\">      <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>delete<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">      <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>delete<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">else</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> When we first press a key we shouldn't execute it directly,\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> instead we send ourself a message to handle it later.\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> Use `make_ref` signify which press we should handle.\n</div><div class=\"line\"></span>    ref <span class=\"keyword operator assignment elixir\">=</span> make_ref<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line hl\">    <span class=\"entity name class elixir\">Process</span><span class=\"punctuation separator method elixir\">.</span>send_after<span class=\"punctuation section function elixir\">(</span>self<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>execute_single_press</span><span class=\"punctuation separator sequence elixir\">,</span> ref<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> double_click_limit<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    state <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">      state\n</div><div class=\"line\">      <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>put<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation separator object elixir\">,</span> now<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">      <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>put<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation separator object elixir\">,</span> ref<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\"><span class=\"punctuation definition comment elixir\">#</span> This is the delayed handling of a single button press.\n</div><div class=\"line hl\"></span><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>execute_single_press</span><span class=\"punctuation separator sequence elixir\">,</span> ref<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> If the stored reference doesn't exist we've handled it as a double click.\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> If we press the button many times (completely mash the button) then\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> we might enter a new interaction and `click_ref` has been replaced by a new one.\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> This equality check prevents such a case, allowing us to only act on the very\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> last press.\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> This is also useful if we in the future want to add double clicks to other buttons.\n</div><div class=\"line\"></span>  <span class=\"keyword control elixir\">if</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator comparison elixir\">==</span> ref <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">    set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">color<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">60</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>delete<span class=\"punctuation section function elixir\">(</span>state<span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">else</span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n<p>You can generalize this concept to triple presses and beyond by keeping a list of timestamps instead of the singular one we use in \n<code class=\"highlight elixir\"><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span></code>,\nbut I personally haven\u2019t found a good use-case for them.</p>\n<aside class=\"note\">\n<p>You might be able to utilize <a href=\"https://hexdocs.pm/elixir/Process.html#cancel_timer/2\">Process.cancel_timer/2</a> as an alternative to the <a href=\"https://hexdocs.pm/elixir/Kernel.html#make_ref/0\">make_ref/0</a> approach I\u2019m using.\nIn theory I guess it\u2019s the better approach as you don\u2019t need to process obsolete messages but <del>I\u2019m too lazy to rewrite it</del> I leave that as an exercise to the reader.</p>\n</aside>\n</section>\n</section>\n<section id=\"Dimming\">\n<h2><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Dimming\">Dimming</a></h2>\n<p>Now, let\u2019s see if we can create a smooth dimming functionality.\nThis is <a href=\"https://community.home-assistant.io/t/philips-tap-dial-switch-with-double-tap-and-4-dial-actions/618988/106\">surprisingly problematic</a>\nbut let\u2019s see what we can come up with.</p>\n<p>Rotating the dial produces a few different actions:</p>\n<div class=\"code-wrapper\"><pre><code><div class=\"line\">dial_rotate_left_step\n</div><div class=\"line\">dial_rotate_left_slow\n</div><div class=\"line\">dial_rotate_left_fast\n</div><div class=\"line\">dial_rotate_right_step\n</div><div class=\"line\">dial_rotate_right_slow\n</div><div class=\"line\">dial_rotate_right_fast\n</div><div class=\"line\">brightness_step_up\n</div><div class=\"line\">brightness_step_down\n</div></code></pre></div>\n<p>Let\u2019s start with <code>dial_rotate_*</code> to set the <code>brightness_step</code> attribute of the light:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>dial_rotate_<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator binary-concatenation elixir\">&lt;&gt;</span> type<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  speed <span class=\"keyword operator assignment elixir\">=</span> rotate_speed<span class=\"punctuation section function elixir\">(</span>type<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">brightness_step<span class=\"punctuation definition constant elixir\">:</span></span> speed<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">rotate_speed</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>left_<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator binary-concatenation elixir\">&lt;&gt;</span> speed<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other keywords elixir\">do:</span></span> <span class=\"keyword operator arithmetic elixir\">-</span>rotate_speed<span class=\"punctuation section function elixir\">(</span>speed<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">rotate_speed</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>right_<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator binary-concatenation elixir\">&lt;&gt;</span> speed<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other keywords elixir\">do:</span></span> rotate_speed<span class=\"punctuation section function elixir\">(</span>speed<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">rotate_speed</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>step<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other keywords elixir\">do:</span></span> <span class=\"constant numeric elixir\">10</span>\n</div><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">rotate_speed</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>slow<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other keywords elixir\">do:</span></span> <span class=\"constant numeric elixir\">20</span>\n</div><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">rotate_speed</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>fast<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other keywords elixir\">do:</span></span> <span class=\"constant numeric elixir\">45</span>\n</div></code></pre></div>\n<p>This works, but the transitions between the steps aren\u2019t smooth as the light immediately jumps to a new brightness value.</p>\n<p>With a transition we can smooth it out:</p>\n<div class=\"code-wrapper\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"comment line number-sign elixir\"><span class=\"punctuation definition comment elixir\">#</span> I read somewhere that 0.4 is standard for Philips Hue.\n</div><div class=\"line\"></span>set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">brightness_step<span class=\"punctuation definition constant elixir\">:</span></span> speed<span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">transition<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">0.4</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div></code></pre></div>\n<p>It\u2019s actually fairly decent (when the stars align).</p>\n<aside class=\"note\">\n<p>There\u2019s also an <code>action_time</code> attribute that\u2019s sent together with <code>dial_rotate_*</code>, signifying how long the action took.\nI tried to incorporate it into the dimmer calculation but I didn\u2019t manage to integrate it in a way that felt like an improvement\nover the simpler approach outlined above.</p>\n</aside>\n<p>As an alternative implementation we can try to use the <code>brightness_step_*</code> actions:</p>\n<div class=\"code-wrapper\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta function elixir\"><span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span>\n</div><div class=\"line\">      <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">       %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span>\n</div><div class=\"line\">         <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>brightness_step_<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator binary-concatenation elixir\">&lt;&gt;</span> dir<span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">         <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action_step_size<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> step\n</div><div class=\"line\">       <span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">      state\n</div><div class=\"line\">    <span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  step <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">case</span> dir <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>up<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span> step\n</div><div class=\"line\">      <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>down<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span> <span class=\"keyword operator arithmetic elixir\">-</span>step\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> Dimming was a little slow, adding a factor speeds things up.\n</div><div class=\"line\"></span>  set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">brightness_step<span class=\"punctuation definition constant elixir\">:</span></span> step <span class=\"keyword operator arithmetic elixir\">*</span> <span class=\"constant numeric elixir\">1.5</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">transition<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">0.4</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n<p>This implementation lets the tap dial itself provide the amount of steps and I do think it feels better than the <code>dial_rotate_*</code> implementation.</p>\n<p>Note that this won\u2019t completely turn off the light and it\u2019ll stop at brightness <code>1</code>.\nWe can instead provide \n<code class=\"highlight elixir\"><span class=\"constant other keywords elixir\">brightness_step_onoff<span class=\"punctuation definition constant elixir\">:</span></span> step</code> to allow the dimmer to turn on and off the light too.</p>\n<aside class=\"warn\">\n<p>When I first implemented this the dimming was really choppy and felt awful,\nwhich led me to create a more elaborate implementation that ultimately spawned this blog post.</p>\n<p>As I\u2019m rewriting this post I\u2019ve noticed the choppiness in my more elaborate implementation too (leading me to delete it entirely).</p>\n<p>I think it\u2019s due to the unreliable latency in the Zigbee network that occasionally cause delays that mess up the responsiveness, regardless of the implementation.\nSometimes you\u2019ll get a long delay before you receive a message or you might get a bunch of messages at the same time.</p>\n<p>I guess the only way to <em>really</em> fix this is to bind the dial to the light directly.</p>\n</aside>\n<section id=\"Other-types-of-transitions\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Other-types-of-transitions\">Other types of transitions</a></h3>\n<p>One of the reasons I wanted a custom implementation was to be able to do other things with the rotary dial.</p>\n<p>For example, maybe I\u2019d like to alter the hue of light by rotating?\nAll we have to do is set the hue instead of the brightness:</p>\n<div class=\"code-wrapper\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\">set<span class=\"punctuation section function elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue_step<span class=\"punctuation definition constant elixir\">:</span></span> step <span class=\"keyword operator arithmetic elixir\">*</span> <span class=\"constant numeric elixir\">0.75</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">transition<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">0.4</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div></code></pre></div>\n<p>(This produces a very cool effect!)</p>\n<p>Another idea is to change the volume by rotating.\nHere\u2019s the code that I use to control the volume of our kitchen speakers (via Home Assistant, not MQTT):</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"constant other keywords elixir\">rotate<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> step <span class=\"keyword operator other elixir\">-&gt;</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> A step of 8 translates to a volume increase of 3%\n</div><div class=\"line\"></span>  volume_step <span class=\"keyword operator assignment elixir\">=</span> step <span class=\"keyword operator arithmetic elixir\">/</span> <span class=\"constant numeric elixir\">8</span> <span class=\"keyword operator arithmetic elixir\">*</span> <span class=\"constant numeric elixir\">3</span> <span class=\"keyword operator arithmetic elixir\">/</span> <span class=\"constant numeric elixir\">100</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> Clamp volume to not accidentally set a very loud or silent volume.\n</div><div class=\"line\"></span>  volume <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> HAStates stores the current states in memory whenever a state is changed.\n</div><div class=\"line\"></span>    <span class=\"punctuation section function elixir\">(</span><span class=\"entity name class elixir\">HAStates</span><span class=\"punctuation separator method elixir\">.</span>get_attribute<span class=\"punctuation section function elixir\">(</span>kitchen_player_ha<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>volume_level</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant numeric elixir\">0.2</span><span class=\"punctuation section function elixir\">)</span> <span class=\"keyword operator arithmetic elixir\">+</span> volume_step<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Math</span><span class=\"punctuation separator method elixir\">.</span>clamp<span class=\"punctuation section function elixir\">(</span><span class=\"constant numeric elixir\">0.05</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant numeric elixir\">0.6</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> Calls the `media_player.volume_set` action.\n</div><div class=\"line\"></span>  <span class=\"entity name class elixir\">MediaPlayer</span><span class=\"punctuation separator method elixir\">.</span>set_volume<span class=\"punctuation section function elixir\">(</span>kitchen_player_ha<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> volume<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> Prevents a possible race condition where we use the old volume level\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">  <span class=\"punctuation definition comment elixir\">#</span> stored in memory for the next rotation.\n</div><div class=\"line\"></span>  <span class=\"entity name class elixir\">HAStates</span><span class=\"punctuation separator method elixir\">.</span>override_attribute<span class=\"punctuation section function elixir\">(</span>kitchen_player_ha<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>volume_level</span><span class=\"punctuation separator object elixir\">,</span> volume<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n</section>\n</section>\n<section id=\"A-use-case-the-boys-bedroom\">\n<h2><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#A-use-case-the-boys-bedroom\">A use-case: the boys bedroom</a></h2>\n<p>We\u2019ve got a bunch of lights in the boys bedroom that we can control and it\u2019s a good use-case for a device such as the Tap Dial.</p>\n<section id=\"Lights-to-control\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Lights-to-control\">Lights to control</a></h3>\n<p>These are the lights we can control in the room:</p>\n<ul>\n<li>\nA ceiling light with color ambiance\n</li>\n<li>\nA window light with white ambiance\n</li>\n<li>\nA floor lamp with white ambiance\n</li>\n<li>\nNight lights for both Loke and Isidor, with color ambiance\n</li>\n<li>\nA lava lamp for Loke, connected to a smart plug\n</li>\n</ul>\n<p>(Yes, I need to get a lava light for Isidor too. They\u2019re awesome!)</p>\n<p>The window light isn\u2019t controlled by the tap dial and there are other automations that controls circadian lighting for most of the lights.</p>\n</section>\n<section id=\"Use-Zigbee-direct-binding\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#Use-Zigbee-direct-binding\">Use Zigbee direct binding</a></h3>\n<p>I\u2019m opting to use direct binding because of two reasons:</p>\n<ol>\n<li>\nDirect binding allows us to dim the light even if the smart home server is down.\n</li>\n<li>\nDespite my efforts, the dimming automation has some latency issues.\n</li>\n</ol>\n<p>Even though it overrides the hold functionality I think direct binding for lights is the way to go.</p>\n</section>\n<section id=\"The-functionality\">\n<h3><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#The-functionality\">The functionality</a></h3>\n<p>These are the functions for the tap dial in the boys room:</p>\n<ul>\n<li>\n<strong>Rotate</strong>: Dim brightness of ceiling light (direct binding)\n</li>\n<li>\n<strong>Hold any</strong>: Turns off the ceiling light (direct binding)\n</li>\n<li>\n<strong>Click 1</strong>: Toggle ceiling light on/off\n</li>\n<li>\n<strong>Double click 1</strong>: Toggle max brightness for ceiling light on/off\n</li>\n<li>\n<strong>Click 2</strong>: Each click goes through different colors for the ceiling light\n</li>\n<li>\n<strong>Click 3</strong>: Toggle floor lamp on/off\n</li>\n<li>\n<strong>Double click 3</strong>: Toggle Isidor\u2019s night light on/off\n</li>\n<li>\n<strong>Hold 3</strong>: Loop through the hue of Isidor\u2019s night light\n</li>\n<li>\n<strong>Click 4</strong>: Toggle Loke\u2019s lava lamp on/off\n</li>\n<li>\n<strong>Double click 4</strong>: Toggle Loke\u2019s night light on/off\n</li>\n<li>\n<strong>Hold 4</strong>: Loop through the hue of Loke\u2019s night light\n</li>\n</ul>\n<p>There\u2019s many different ways you can design the interactions and I may switch it up in the future, but for now this works well.</p>\n<aside class=\"warn\">\n<p>While I normally wouldn\u2019t use direct bindings together with hold functionality (as here it will also turn off the ceiling light), in this case I think it works well.</p>\n</aside>\n</section>\n</section>\n<section id=\"A-generalized-tap-dial-controller\">\n<h2><a class=\"heading-ref\" href=\"https://www.jonashietala.se/#A-generalized-tap-dial-controller\">A generalized tap dial controller</a></h2>\n<p>The code I\u2019ve shown you so far has been a little simplified to explain the general approach.\nAs I have several tap dials around the house I\u2019ve made a general tap dial controller with a more declarative approach.</p>\n<p>For example, here\u2019s how the tap dial in the boys room is defined:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"entity name class elixir\">TapDialController</span><span class=\"punctuation separator method elixir\">.</span>start_link<span class=\"punctuation section function elixir\">(</span>\n</div><div class=\"line\">  <span class=\"constant other keywords elixir\">device<span class=\"punctuation definition constant elixir\">:</span></span> boys_room_tap_dial<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">  <span class=\"constant other keywords elixir\">scene<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">0</span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">  <span class=\"constant other keywords elixir\">rotate<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> _step <span class=\"keyword operator other elixir\">-&gt;</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> This disables the existing circadian automation.\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> I found that manually disabling it is more reliable than trying to\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> detect external changes over MQTT as messages may be delayed and arrive out of order.\n</div><div class=\"line\"></span>    <span class=\"entity name class elixir\">LightController</span><span class=\"punctuation separator method elixir\">.</span>set_manual_override<span class=\"punctuation section function elixir\">(</span>boys_room_ceiling_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant language elixir\">true</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">  <span class=\"constant other keywords elixir\">button_1<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">click<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>boys_room_ceiling_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">state<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>TOGGLE<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">double_click<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">      <span class=\"punctuation definition comment elixir\">#</span> This function compares the current light status and sets it to 100%\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">      <span class=\"punctuation definition comment elixir\">#</span> or reverts back to circadian lighting (if setup for the light).\n</div><div class=\"line\"></span>      <span class=\"entity name class elixir\">HueLights</span><span class=\"punctuation separator method elixir\">.</span>toggle_max_brightness<span class=\"punctuation section function elixir\">(</span>boys_room_ceiling_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">  <span class=\"constant other keywords elixir\">button_2<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">click<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> state <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">      <span class=\"punctuation definition comment elixir\">#</span> The light controller normally uses circadian lighting to update\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">      <span class=\"punctuation definition comment elixir\">#</span> the light. Setting manual override pauses circadian lighting,\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">      <span class=\"punctuation definition comment elixir\">#</span> allowing us to manually control the light.\n</div><div class=\"line\"></span>      <span class=\"entity name class elixir\">LightController</span><span class=\"punctuation separator method elixir\">.</span>set_manual_override<span class=\"punctuation section function elixir\">(</span>boys_room_ceiling_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant language elixir\">true</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">      <span class=\"punctuation definition comment elixir\">#</span> This function steps through different light states for the ceiling light\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">      <span class=\"punctuation definition comment elixir\">#</span> (hue 0..300 with 60 intervals) and stores it in `state`.\n</div><div class=\"line\"></span>      next_scene<span class=\"punctuation section function elixir\">(</span>state<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">  <span class=\"constant other keywords elixir\">button_3<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">click<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>boys_room_floor_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">state<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>TOGGLE<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">double_click<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>isidor_sleep_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">state<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>TOGGLE<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">hold<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>isidor_sleep_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue_move<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">40</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">color<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">saturation<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">100</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">hold_release<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>isidor_sleep_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue_move<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">0</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">  <span class=\"constant other keywords elixir\">button_4<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">click<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>loke_lava_lamp<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">state<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>TOGGLE<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">brightness<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">254</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">double_click<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>loke_sleep_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">state<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>TOGGLE<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">hold<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>loke_sleep_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue_move<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">40</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other keywords elixir\">color<span class=\"punctuation definition constant elixir\">:</span></span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">saturation<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">100</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span><span class=\"punctuation separator sequence elixir\">,</span>\n</div><div class=\"line\">    <span class=\"constant other keywords elixir\">hold_release<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"keyword control elixir\">fn</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>set<span class=\"punctuation section function elixir\">(</span>loke_sleep_light<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> %<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other keywords elixir\">hue_move<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant numeric elixir\">0</span><span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\"><span class=\"punctuation section function elixir\">)</span>\n</div></code></pre></div>\n<p>I\u2019m not going to go through the implementation of the controller in detail.\nHere\u2019s the code you can read through if you want:</p>\n<div class=\"code-wrapper wide\"><div class=\"descr\"></div><pre><code class=\"highlight elixir\"><div class=\"line\"><span class=\"meta module elixir\"><span class=\"keyword control module elixir\">defmodule</span> <span class=\"entity name class elixir\">Haex</span>.<span class=\"entity name class elixir\">Mqtt</span>.<span class=\"entity name class elixir\">TapDialController</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">use</span> <span class=\"entity name class elixir\">GenServer</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">alias</span> <span class=\"entity name class elixir\">Haex</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">Mqtt</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">alias</span> <span class=\"entity name class elixir\">Haex</span><span class=\"punctuation separator method elixir\">.</span><span class=\"entity name class elixir\">Mock</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">require</span> <span class=\"entity name class elixir\">Logger</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  <span class=\"variable other module elixir\"><span class=\"keyword operator definition constant elixir\">@</span>impl</span> <span class=\"constant language elixir\">true</span>\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">init</span><span class=\"punctuation definition parameters elixir\">(</span>opts<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> This allows us to setup expectations and to collect what messages\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> the controller sends during unit testing.\n</div><div class=\"line\"></span>    <span class=\"keyword control elixir\">if</span> parent <span class=\"keyword operator assignment elixir\">=</span> opts<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>parent</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Mock</span><span class=\"punctuation separator method elixir\">.</span>allow<span class=\"punctuation section function elixir\">(</span>parent<span class=\"punctuation separator object elixir\">,</span> self<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    device <span class=\"keyword operator assignment elixir\">=</span> opts<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>device</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator other elixir\">|</span><span class=\"keyword operator other elixir\">|</span> <span class=\"keyword control elixir\">raise</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>Must specify `device`, got: </span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"punctuation section interpolation begin elixir\">#{</span></span></span></span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"source elixir embedded\">inspect<span class=\"punctuation section function elixir\">(</span>opts<span class=\"punctuation section function elixir\">)</span></span><span class=\"punctuation section interpolation end elixir\">}</span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string end elixir\">&quot;</span></span></span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> Just subscribes to pubsub under the hood.\n</div><div class=\"line\"></span>    <span class=\"entity name class elixir\">Mqtt</span><span class=\"punctuation separator method elixir\">.</span>subscribe_events<span class=\"punctuation section function elixir\">(</span>device<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    state <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">      <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>new<span class=\"punctuation section function elixir\">(</span>opts<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">      <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>put_new<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>double_click_timeout</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant numeric elixir\">350</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>ok</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">start_link</span><span class=\"punctuation definition parameters elixir\">(</span>opts<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"entity name class elixir\">GenServer</span><span class=\"punctuation separator method elixir\">.</span>start_link<span class=\"punctuation section function elixir\">(</span><span class=\"variable language elixir\">__MODULE__</span><span class=\"punctuation separator object elixir\">,</span> opts<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\">  <span class=\"variable other module elixir\"><span class=\"keyword operator definition constant elixir\">@</span>impl</span> <span class=\"constant language elixir\">true</span>\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>mqtt</span><span class=\"punctuation separator sequence elixir\">,</span> _topic<span class=\"punctuation separator sequence elixir\">,</span> payload<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">case</span> parse_action<span class=\"punctuation section function elixir\">(</span>payload<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>button</span><span class=\"punctuation separator sequence elixir\">,</span> button<span class=\"punctuation separator sequence elixir\">,</span> fun<span class=\"punctuation section sequence end elixir\">}</span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">        <span class=\"punctuation definition comment elixir\">#</span> We specify handlers with `button_3: %{}` specs.\n</div><div class=\"line\"></span>        <span class=\"keyword control elixir\">case</span> fetch_button_handler<span class=\"punctuation section function elixir\">(</span>button<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">          <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>ok</span><span class=\"punctuation separator sequence elixir\">,</span> spec<span class=\"punctuation section sequence end elixir\">}</span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">            <span class=\"punctuation definition comment elixir\">#</span> Dispatch to action handlers, such as `handle_hold` and `handle_press_release`.\n</div><div class=\"line\"></span>            fun<span class=\"punctuation separator method elixir\">.</span><span class=\"punctuation section function elixir\">(</span>spec<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">          <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>not_found</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">            <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">        <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\">      <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>rotate</span><span class=\"punctuation separator sequence elixir\">,</span> step<span class=\"punctuation section sequence end elixir\">}</span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"keyword control elixir\">case</span> fetch_rotate_handler<span class=\"punctuation section function elixir\">(</span>state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">          <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>ok</span><span class=\"punctuation separator sequence elixir\">,</span> cb<span class=\"punctuation section sequence end elixir\">}</span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">            call_handler<span class=\"punctuation section function elixir\">(</span>cb<span class=\"punctuation separator object elixir\">,</span> step<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">          <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>not_found</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">            <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">        <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\">      <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>skip</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">def</span> <span class=\"entity name function public elixir\">handle_info</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>execute_single_press</span><span class=\"punctuation separator sequence elixir\">,</span> ref<span class=\"punctuation separator sequence elixir\">,</span> cb<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> Only execute the callback for the last action.\n</div><div class=\"line\"></span>    <span class=\"keyword control elixir\">if</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator comparison elixir\">==</span> ref <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      call_handler<span class=\"punctuation section function elixir\">(</span>cb<span class=\"punctuation separator object elixir\">,</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>delete<span class=\"punctuation section function elixir\">(</span>state<span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">else</span>\n</div><div class=\"line\">      <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">handle_press_release</span><span class=\"punctuation definition parameters elixir\">(</span>spec<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    single_click_handler <span class=\"keyword operator assignment elixir\">=</span> spec<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click</span><span class=\"punctuation section array elixir\">]</span>\n</div><div class=\"line\">    double_click_handler <span class=\"keyword operator assignment elixir\">=</span> spec<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>double_click</span><span class=\"punctuation section array elixir\">]</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    <span class=\"keyword control elixir\">cond</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      double_click_handler <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        now <span class=\"keyword operator assignment elixir\">=</span> <span class=\"entity name class elixir\">DateTime</span><span class=\"punctuation separator method elixir\">.</span>utc_now<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">        valid_double_click? <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">          state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator logical elixir\">&amp;&amp;</span>\n</div><div class=\"line\">            <span class=\"entity name class elixir\">DateTime</span><span class=\"punctuation separator method elixir\">.</span>diff<span class=\"punctuation section function elixir\">(</span>now<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section array elixir\">]</span><span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>millisecond</span><span class=\"punctuation section function elixir\">)</span> <span class=\"keyword operator comparison elixir\">&lt;</span> state<span class=\"punctuation separator method elixir\">.</span>double_click_timeout\n</div><div class=\"line\">\n</div><div class=\"line\">        <span class=\"keyword control elixir\">if</span> valid_double_click? <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">          <span class=\"punctuation definition comment elixir\">#</span> Execute a double click immediately.\n</div><div class=\"line\"></span>          state <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">            state\n</div><div class=\"line\">            <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>delete<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">            <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>delete<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">          call_handler<span class=\"punctuation section function elixir\">(</span>double_click_handler<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">        <span class=\"keyword control elixir\">else</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">          <span class=\"punctuation definition comment elixir\">#</span> Delay single click to see if we get a double click later.\n</div><div class=\"line\"></span>          ref <span class=\"keyword operator assignment elixir\">=</span> make_ref<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">          <span class=\"entity name class elixir\">Process</span><span class=\"punctuation separator method elixir\">.</span>send_after<span class=\"punctuation section function elixir\">(</span>\n</div><div class=\"line\">            self<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">            <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>execute_single_press</span><span class=\"punctuation separator sequence elixir\">,</span> ref<span class=\"punctuation separator sequence elixir\">,</span> single_click_handler<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation separator object elixir\">,</span>\n</div><div class=\"line\">            state<span class=\"punctuation separator method elixir\">.</span>double_click_timeout\n</div><div class=\"line\">          <span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">          state <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">            state\n</div><div class=\"line\">            <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>put<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>last_press</span><span class=\"punctuation separator object elixir\">,</span> now<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">            <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>put<span class=\"punctuation section function elixir\">(</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>click_ref</span><span class=\"punctuation separator object elixir\">,</span> ref<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">          <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">        <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\">      single_click_handler <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">        <span class=\"punctuation definition comment elixir\">#</span> No double click handler, so we can directly execute the single click.\n</div><div class=\"line\"></span>        call_handler<span class=\"punctuation section function elixir\">(</span>single_click_handler<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">      <span class=\"constant language elixir\">true</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">handle_hold</span><span class=\"punctuation definition parameters elixir\">(</span>spec<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    call_handler<span class=\"punctuation section function elixir\">(</span>spec<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>hold</span><span class=\"punctuation section array elixir\">]</span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">handle_hold_release</span><span class=\"punctuation definition parameters elixir\">(</span>spec<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    call_handler<span class=\"punctuation section function elixir\">(</span>spec<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>hold_release</span><span class=\"punctuation section array elixir\">]</span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">call_handler</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"constant language elixir\">nil</span><span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">call_handler</span><span class=\"punctuation definition parameters elixir\">(</span>handler<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\"><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> If a callback expects one argument we'll also send the state,\n</div><div class=\"line\"></span><span class=\"comment line number-sign elixir\">    <span class=\"punctuation definition comment elixir\">#</span> otherwise we simply call it.\n</div><div class=\"line\"></span>    <span class=\"keyword control elixir\">case</span> <span class=\"entity name class elixir\">Function</span><span class=\"punctuation separator method elixir\">.</span>info<span class=\"punctuation section function elixir\">(</span>handler<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>arity</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"constant numeric elixir\">0</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        handler<span class=\"punctuation separator method elixir\">.</span><span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">\n</div><div class=\"line\">      <span class=\"constant numeric elixir\">1</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> handler<span class=\"punctuation separator method elixir\">.</span><span class=\"punctuation section function elixir\">(</span>state<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">\n</div><div class=\"line\">      x <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"entity name class elixir\">Logger</span><span class=\"punctuation separator method elixir\">.</span>error<span class=\"punctuation section function elixir\">(</span>\n</div><div class=\"line\">          <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>Unsupported cb arity `</span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"punctuation section interpolation begin elixir\">#{</span></span></span></span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"source elixir embedded\">x</span><span class=\"punctuation section interpolation end elixir\">}</span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\">` for </span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"punctuation section interpolation begin elixir\">#{</span></span></span></span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"source elixir embedded\">state<span class=\"punctuation separator method elixir\">.</span>device</span><span class=\"punctuation section interpolation end elixir\">}</span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"> tap dial expecting 0 or 1 args<span class=\"punctuation definition string end elixir\">&quot;</span></span></span>\n</div><div class=\"line\">        <span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">call_handler</span><span class=\"punctuation definition parameters elixir\">(</span><span class=\"constant language elixir\">nil</span><span class=\"punctuation separator object elixir\">,</span> _arg1<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">call_handler</span><span class=\"punctuation definition parameters elixir\">(</span>handler<span class=\"punctuation separator object elixir\">,</span> arg1<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">case</span> <span class=\"entity name class elixir\">Function</span><span class=\"punctuation separator method elixir\">.</span>info<span class=\"punctuation section function elixir\">(</span>handler<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>arity</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"constant numeric elixir\">1</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        handler<span class=\"punctuation separator method elixir\">.</span><span class=\"punctuation section function elixir\">(</span>arg1<span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">\n</div><div class=\"line\">      <span class=\"constant numeric elixir\">2</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> handler<span class=\"punctuation separator method elixir\">.</span><span class=\"punctuation section function elixir\">(</span>arg1<span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">\n</div><div class=\"line\">      x <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"entity name class elixir\">Logger</span><span class=\"punctuation separator method elixir\">.</span>error<span class=\"punctuation section function elixir\">(</span>\n</div><div class=\"line\">          <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>Unsupported cb arity `</span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"punctuation section interpolation begin elixir\">#{</span></span></span></span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"source elixir embedded\">x</span><span class=\"punctuation section interpolation end elixir\">}</span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\">` for </span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"punctuation section interpolation begin elixir\">#{</span></span></span></span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"source elixir embedded\">state<span class=\"punctuation separator method elixir\">.</span>device</span><span class=\"punctuation section interpolation end elixir\">}</span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"> tap dial  expecting 1 or 2 args<span class=\"punctuation definition string end elixir\">&quot;</span></span></span>\n</div><div class=\"line\">        <span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>noreply</span><span class=\"punctuation separator sequence elixir\">,</span> state<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">parse_action</span><span class=\"punctuation definition parameters elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>brightness_step_<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator binary-concatenation elixir\">&lt;&gt;</span> dir<span class=\"punctuation separator sequence elixir\">,</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action_step_size<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> step<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    step <span class=\"keyword operator assignment elixir\">=</span>\n</div><div class=\"line\">      <span class=\"keyword control elixir\">case</span> dir <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">        <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>up<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span> step\n</div><div class=\"line\">        <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>down<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator arrow elixir\">-&gt;</span> <span class=\"keyword operator arithmetic elixir\">-</span>step\n</div><div class=\"line\">      <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>rotate</span><span class=\"punctuation separator sequence elixir\">,</span> step<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">parse_action</span><span class=\"punctuation definition parameters elixir\">(</span>%<span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>action<span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator map-pair elixir\">=&gt;</span> action<span class=\"punctuation section sequence end elixir\">}</span></span><span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">case</span> <span class=\"entity name class elixir\">Regex</span><span class=\"punctuation separator method elixir\">.</span>run<span class=\"punctuation section function elixir\">(</span><span class=\"meta string elixir\"><span class=\"storage type string elixir\">~r</span></span><span class=\"meta string elixir\"><span class=\"string interpolated elixir\"><span class=\"punctuation definition string begin elixir\">/</span><span class=\"meta literal regexp elixir\">b</span><span class=\"meta literal regexp elixir\">u</span><span class=\"meta literal regexp elixir\">t</span><span class=\"meta literal regexp elixir\">t</span><span class=\"meta literal regexp elixir\">o</span><span class=\"meta literal regexp elixir\">n</span><span class=\"meta literal regexp elixir\">_</span><span class=\"meta group regexp elixir\"><span class=\"keyword control group regexp elixir\"><span class=\"punctuation definition group begin regexp elixir\">(</span></span></span><span class=\"meta group regexp elixir\"><span class=\"constant other escape-sequence regexp elixir\">\\d</span></span><span class=\"meta group regexp elixir\"><span class=\"keyword control group regexp elixir\"><span class=\"punctuation definition group end regexp elixir\">)</span></span></span><span class=\"meta literal regexp elixir\">_</span><span class=\"meta group regexp elixir\"><span class=\"keyword control group regexp elixir\"><span class=\"punctuation definition group begin regexp elixir\">(</span></span></span><span class=\"meta group regexp elixir\"><span class=\"constant other escape-sequence regexp elixir\">\\w</span><span class=\"meta quantifier regexp elixir\"><span class=\"keyword operator quantifier regexp elixir\">+</span></span></span><span class=\"meta group regexp elixir\"><span class=\"keyword control group regexp elixir\"><span class=\"punctuation definition group end regexp elixir\">)</span></span></span>/</span></span><span class=\"punctuation separator object elixir\">,</span> action<span class=\"punctuation separator object elixir\">,</span> <span class=\"constant other keywords elixir\">capture<span class=\"punctuation definition constant elixir\">:</span></span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>all_but_first</span><span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"punctuation section array elixir\">[</span>button<span class=\"punctuation separator object elixir\">,</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>press_release<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>button</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"entity name class elixir\">String</span><span class=\"punctuation separator method elixir\">.</span>to_integer<span class=\"punctuation section function elixir\">(</span>button<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"variable other capture elixir\"><span class=\"keyword operator capture elixir\">&amp;</span>handle_press_release</span><span class=\"keyword operator arithmetic elixir\">/</span><span class=\"constant numeric elixir\">2</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">\n</div><div class=\"line\">      <span class=\"punctuation section array elixir\">[</span>button<span class=\"punctuation separator object elixir\">,</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>hold<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>button</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"entity name class elixir\">String</span><span class=\"punctuation separator method elixir\">.</span>to_integer<span class=\"punctuation section function elixir\">(</span>button<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"variable other capture elixir\"><span class=\"keyword operator capture elixir\">&amp;</span>handle_hold</span><span class=\"keyword operator arithmetic elixir\">/</span><span class=\"constant numeric elixir\">2</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">\n</div><div class=\"line\">      <span class=\"punctuation section array elixir\">[</span>button<span class=\"punctuation separator object elixir\">,</span> <span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>hold_release<span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>button</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"entity name class elixir\">String</span><span class=\"punctuation separator method elixir\">.</span>to_integer<span class=\"punctuation section function elixir\">(</span>button<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"variable other capture elixir\"><span class=\"keyword operator capture elixir\">&amp;</span>handle_hold_release</span><span class=\"keyword operator arithmetic elixir\">/</span><span class=\"constant numeric elixir\">2</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">\n</div><div class=\"line\">      _ <span class=\"keyword operator arrow elixir\">-&gt;</span>\n</div><div class=\"line\">        <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>skip</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">parse_action</span><span class=\"punctuation definition parameters elixir\">(</span>_action<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"entity name class elixir\">Logger</span><span class=\"punctuation separator method elixir\">.</span>debug<span class=\"punctuation section function elixir\">(</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>Skip fallback tap dial action: </span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"punctuation section interpolation begin elixir\">#{</span></span></span></span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"source elixir embedded\">inspect<span class=\"punctuation section function elixir\">(</span>action<span class=\"punctuation section function elixir\">)</span></span><span class=\"punctuation section interpolation end elixir\">}</span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string end elixir\">&quot;</span></span></span><span class=\"punctuation section function elixir\">)</span>\n</div><div class=\"line\">    <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>skip</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">fetch_button_handler</span><span class=\"punctuation definition parameters elixir\">(</span>button<span class=\"punctuation separator object elixir\">,</span> state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    spec <span class=\"keyword operator assignment elixir\">=</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string begin elixir\">&quot;</span>button_</span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"punctuation section interpolation begin elixir\">#{</span></span></span></span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"meta interpolation elixir\"><span class=\"source elixir embedded\">button</span><span class=\"punctuation section interpolation end elixir\">}</span></span></span></span><span class=\"source elixir\"><span class=\"meta string elixir\"><span class=\"string quoted double elixir\"><span class=\"punctuation definition string end elixir\">&quot;</span></span></span> <span class=\"keyword operator pipe elixir\">|&gt;</span> <span class=\"entity name class elixir\">String</span><span class=\"punctuation separator method elixir\">.</span>to_atom<span class=\"punctuation section function elixir\">(</span><span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section array elixir\">]</span>\n</div><div class=\"line\">\n</div><div class=\"line\">    <span class=\"keyword control elixir\">if</span> spec <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>ok</span><span class=\"punctuation separator sequence elixir\">,</span> <span class=\"entity name class elixir\">Map</span><span class=\"punctuation separator method elixir\">.</span>put<span class=\"punctuation section function elixir\">(</span>spec<span class=\"punctuation separator sequence elixir\">,</span> <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>button</span><span class=\"punctuation separator sequence elixir\">,</span> button<span class=\"punctuation section function elixir\">)</span><span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">else</span>\n</div><div class=\"line\">      <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>not_found</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">\n</div><div class=\"line\"><span class=\"meta function elixir\">  <span class=\"keyword control module elixir\">defp</span> <span class=\"entity name function private elixir\">fetch_rotate_handler</span><span class=\"punctuation definition parameters elixir\">(</span>state<span class=\"punctuation section function elixir\">)</span> <span class=\"keyword control module elixir\">do</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">if</span> spec <span class=\"keyword operator assignment elixir\">=</span> state<span class=\"punctuation section array elixir\">[</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>rotate</span><span class=\"punctuation section array elixir\">]</span> <span class=\"keyword control elixir\">do</span>\n</div><div class=\"line\">      <span class=\"meta sequence tuple elixir\"><span class=\"punctuation section sequence begin elixir\">{</span><span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>ok</span><span class=\"punctuation separator sequence elixir\">,</span> spec<span class=\"punctuation section sequence end elixir\">}</span></span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">else</span>\n</div><div class=\"line\">      <span class=\"constant other symbol elixir\"><span class=\"punctuation definition constant elixir\">:</span>not_found</span>\n</div><div class=\"line\">    <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\">  <span class=\"keyword control elixir\">end</span>\n</div><div class=\"line\"><span class=\"keyword control elixir\">end</span>\n</div></code></pre></div>\n</section>"
            ],
            "link": "https://www.jonashietala.se/blog/2025/09/01/automating_the_hue_tap_dial_switch_in_elixir_via_mqtt",
            "publishedAt": "2025-09-01",
            "source": "Jonas Hietala",
            "summary": "<figure><img alt=\"\" src=\"https://www.jonashietala.se/images/hue_tap_dial.jpg\" /> </figure> <p>I recently bought a couple of <a href=\"https://www.philips-hue.com/sv-se/p/hue-tap-dial-switch/8719514440999\">Hue Tap Dial</a> switches for our house to enhance our smart home. We have quite a few smart lights and I figured <a href=\"https://www.philips-hue.com/sv-se/p/hue-tap-dial-switch/8719514440999\">the tap dial</a>\u2014with it\u2019s multiple buttons and rotary dial\u2014would be a good fit.</p> <p>Since I\u2019ve been moving away from standard Home Assistant automations to <a href=\"https://www.jonashietala.se/blog/2024/10/08/writing_home_assistant_automations_using_genservers_in_elixir/\">my own automation engine in Elixir</a> I had to figure out how best to integrate the tap dial.</p> <p>At first I tried to rely on my existing <a href=\"https://www.home-assistant.io/\">Home Assistant</a> connection but I realized that it\u2019s better to bypass <a href=\"https://www.home-assistant.io/\">Home Assistant</a> and go directly via <a href=\"https://mqtt.org/\">MQTT</a>, as I already use <a href=\"https://www.zigbee2mqtt.io/\">Zigbee2MQTT</a> as the way to get Zigbee devices into <a href=\"https://www.home-assistant.io/\">Home Assistant</a>.</p> <p>This post walks through how I set it all up and I\u2019ll end up with an example of how I control multiple Zigbee lights from one dial via Elixir.</p> <aside class=\"tip\"> <p>In the <a href=\"https://www.jonashietala.se/blog/2024/10/08/writing_home_assistant_automations_using_genservers_in_elixir/\">post about my automation engine</a> I demonstrated how I controlled lights from Elixir via <a href=\"https://www.home-assistant.io/\">Home Assistant</a> states and actions. For the devices that supports it, it\u2019s better to communicate directly over <a href=\"https://mqtt.org/\">MQTT</a> as you\u2019ll get better latency and more",
            "title": "Automating the Hue Tap Dial Switch in Elixir via MQTT"
        },
        {
            "content": [
                "<p>This is the weekly visible open thread. Post about anything you want, ask random questions, whatever. ACX has an unofficial <a href=\"https://www.reddit.com/r/slatestarcodex/\">subreddit</a>, <a href=\"https://discord.gg/RTKtdut\">Discord</a>, and <a href=\"https://www.datasecretslox.com/index.php\">bulletin board</a>, and <a href=\"https://www.lesswrong.com/community?filters%5B0%5D=SSC\">in-person meetups around the world</a>. Most content is free, some is subscriber only; you can subscribe <strong><a href=\"https://astralcodexten.substack.com/subscribe\">here</a></strong>. Also:</p><div><hr /></div><p><strong>1: </strong>Sorry for no review this Friday. I had time-sensitive requests for the open letter and meetups posts, and didn&#8217;t want to send you guys three emails in twenty-four hours. Reviews will resume this coming week.</p><div><hr /></div><p><strong>2: </strong>Speaking of the open letter - sorry about mishandling it. The authors wanted to make things easy for me and gave me a pre-written post in what they thought was ACX style / my own voice. I hate pretending I wrote things that I didn&#8217;t, so I posted it in a quote block and attributed it to the authors. Readers assumed that anything in a quote block attributed to &#8220;open letter authors&#8221; must be the text of the open letter, and vocally criticized it as inappropriate for open letter text. I edited the post to clarify the situation after a few minutes, but some of you may have read it before then, or by email. You can read the actual open letter text <a href=\"https://docs.google.com/document/d/1EasYbeIRB9b-rS4Em5PcnYAeiWyXXzkzFhl03ebEpTQ/edit?tab=t.0\">here</a>.</p><div><hr /></div><p><strong>3: </strong>Meetups this week in Athens, Markham, Bozeman, Barcelona, Bucharest, Dayton, Dubai, Edinburgh, Erlangen, Klang Valley, Lyon, Manhattan/NYC, Newton (MA), Northampton (MA), Simi Valley, Vancouver, Williamsburg, and Zurich, see <a href=\"https://www.astralcodexten.com/p/meetups-everywhere-2025-times-and\">the meetups post</a> for more. And two minor corrections: Berkeley is on Tuesday (not Thursday), and London is on Saturday (not Friday).</p><div><hr /></div><p><strong>4: </strong>Thanks to everyone who responded to my request for ACX Grants evaluators in aerospace, climatetech, and policy. I got ~two dozen aerospace experts, ~one dozen climatetech experts, and one policy expert (surprising given how confident some of you sound during policy discussions in the comments!) To those of you who responded on aerospace or climatetech - thank you so much, but I probably won&#8217;t be contacting most of you. To the one person who responded on policy, you might be getting more than you bargained for (but feel free to say no).</p><div><hr /></div><p><strong>5: </strong>New subscriber-only post, <a href=\"https://www.astralcodexten.com/p/the-economics-of-envy\">The Economy of Envy</a>, about consumer behavior among 1.5 year old twins:</p><blockquote><p>Much of my parenting time is spent trying to minimize toy and book theft. A typical cycle will go like this: Kai will be playing with a toy drum. Lyra will see and try to steal the drum from him. I will prevent her. She will scream. In order to defuse the crisis, I must get some other toy to interest her more. This is very easy, because her level of interest in any toy is directly proportional to how interested other people seem by it. So I will take the digital thermometer, point it at my head, and take my temperature. &#8220;Wow,&#8221; I will say, &#8220;I&#8217;m having lots of fun using this thermometer. Might this thermometer be . . . <em>the most fun toy in the entire world???&#8221;</em> Then Lyra will scream because she doesn&#8217;t have the thermometer. &#8220;Fine,&#8221; I will say, as if I am making some deep concession. &#8220;I <em>suppose</em> you can have the thermometer.&#8221; Her face will light up and she will start repeatedly hitting the thermometer button like a rat pulling the deliver-opioids lever.</p><p>All of this was to protect Kai&#8217;s ability to play with his toy drum. But more likely than not, Kai will have seen this whole spectacle and now <em>he</em> wants the digital thermometer. &#8220;Mine! Mine!&#8221; he will scream, the toy drum totally abandoned in his newfound distress. &#8220;Noooooo!&#8221; Lyra will shout, clutching the thermometer close to her chest. &#8220;Look!&#8221; I tell Lyra. &#8220;The drum you wanted is free now! You can have it! Take it! Go!&#8221; Sometimes this will solve the whole problem. Lyra will take the drum, Kai will take the thermometer, everyone is happy. Other times Lyra will refuse to give the thermometer up for a stupid drum. Other times she&#8217;ll agree, but as soon as Kai sees Lyra playing with the drum, he&#8217;ll forget about the thermometer and want the drum back. After some number of cycles, this hopefully converges to both kids having a toy they will tolerate for at least sixty seconds, which is enough time for me to wind down, regain my composure, and prepare for the cycle to start again.</p></blockquote>"
            ],
            "link": "https://www.astralcodexten.com/p/open-thread-397",
            "publishedAt": "2025-09-01",
            "source": "SlateStarCodex",
            "summary": "<p>This is the weekly visible open thread. Post about anything you want, ask random questions, whatever. ACX has an unofficial <a href=\"https://www.reddit.com/r/slatestarcodex/\">subreddit</a>, <a href=\"https://discord.gg/RTKtdut\">Discord</a>, and <a href=\"https://www.datasecretslox.com/index.php\">bulletin board</a>, and <a href=\"https://www.lesswrong.com/community?filters%5B0%5D=SSC\">in-person meetups around the world</a>. Most content is free, some is subscriber only; you can subscribe <strong><a href=\"https://astralcodexten.substack.com/subscribe\">here</a></strong>. Also:</p><div><hr /></div><p><strong>1: </strong>Sorry for no review this Friday. I had time-sensitive requests for the open letter and meetups posts, and didn&#8217;t want to send you guys three emails in twenty-four hours. Reviews will resume this coming week.</p><div><hr /></div><p><strong>2: </strong>Speaking of the open letter - sorry about mishandling it. The authors wanted to make things easy for me and gave me a pre-written post in what they thought was ACX style / my own voice. I hate pretending I wrote things that I didn&#8217;t, so I posted it in a quote block and attributed it to the authors. Readers assumed that anything in a quote block attributed to &#8220;open letter authors&#8221; must be the text of the open letter, and vocally criticized it as inappropriate for open letter text. I edited the post to clarify the situation after a few minutes, but some of you may have read it before then, or by",
            "title": "Open Thread 397"
        },
        {
            "content": [
                "<p>There\u2019s quite a lot in the queue since last time, so this is the first large chunk of it, which focuses on apps and otherwise finding an initial connection, and some things that directly impact that.</p>\n<h4>Table of Contents</h4>\n<ol>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-have-no-friends-to-date\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Have No Friends To Date.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-aren-t-willing-to-be-dungeon-master\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Aren\u2019t Willing To Be Dungeon Master.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-didn-t-listen-to-my-friend-s-podcast\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Didn\u2019t Listen To My Friend\u2019s Podcast.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-flunk-the-eye-contact-test\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Flunk The Eye Contact Test.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-the-women-don-t-hit-on-the-men\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because The Women Don\u2019t Hit On The Men.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-when-a-woman-did-hit-on-you-you-choked\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because When A Woman Did Hit On You, You Choked.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-don-t-know-the-flirtation-escalation-ladder\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Don\u2019t Know The Flirtation Escalation Ladder.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-will-actually-never-open\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Will Actually Never Open.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-we-let-tinder-win\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because We Let Tinder Win.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-the-apps-are-bad-on-purpose-to-make-you-click\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because The Apps Are Bad On Purpose To Make You Click.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-present-super-weird\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Present Super Weird.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-have-the-wrong-hobbies\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Have The Wrong Hobbies.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-do-the-wrong-kind-of-magic\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Do The Wrong Kind Of Magic.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-and-all-that-rejection-really-sucks\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single And All That Rejection Really Sucks.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-dating-apps-are-designed-like-tiktok\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because Dating Apps Are Designed Like TikTok.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-and-here-s-aella-with-a-tea-update\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single And Here\u2019s Aella With a Tea Update.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-don-t-have-a-date-me-doc\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Don\u2019t Have a Date Me Doc.</a></li>\n<li><a href=\"https://thezvi.substack.com/i/172212715/you-re-single-because-you-didn-t-hire-a-matchmaker\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">You\u2019re Single Because You Didn\u2019t Hire a Matchmaker.</a></li>\n</ol>\n<p><span id=\"more-24686\"></span></p>\n<h4>You\u2019re Single Because You Have No Friends To Date</h4>\n<p><a href=\"https://x.com/CostelloWilliam/status/1911562746933428385\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Two thirds of romantic partners were friends first</a>, especially at university.</p>\n<blockquote><p>Paula Ghete: Does this mean that a degree of concern is warranted that platonic friendships between people of the opposite sex can turn into an actual relationship one day (or an affair)? As far as I know, men tend to choose female friends who are attractive.</p>\n<p>William Costello: Yes!</p></blockquote>\n<p>Two thirds really is an awful lot. It\u2019s enough of an awful lot to suggest that if your current goal is a long term relationship rather than short term dating, and you have enough practice, it might outright be a mistake to be primarily (rather than opportunistically or additionally, the goods are often non-rivalrous) trying to date people who aren\u2019t your friends or at least friends of friends? That instead you should focus on making platonic friends with people you find attractive, without trying to date them at all, and then see what happens?</p>\n<p>Highly speculative, but potentially this has a lot of advantages, including a network that can lead to dates with non-friends. It\u2019s pretty great to have friends even if there are never any non-platonic benefits.</p>\n<p>It does have its own difficulties. The most obvious one is that if you\u2019re not trying to date them, you need a different excuse and set of activities in order to become friends.</p>\n<p><a href=\"https://www.researchgate.net/publication/353199988_The_Friends-to-Lovers_Pathway_to_Romance_Prevalent_Preferred_and_Overlooked_by_Science#read\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">As the paper notes</a>, this raises the question of why we so often have the opposite impression, or that the youth think that hitting on your friends is just awful &#8211; although perhaps they do think that in cases where it doesn\u2019t work, there\u2019s no contradiction there, if you can\u2019t do subtle escalations instead then one could say that\u2019s a skill issue.</p>\n<p>There\u2019s also \u2018an app for that\u2019 at least inside the rationalist community, called Reciprocity, where you can signal interest and then it only reveals if there is a two-sided match. If this is your strategy it is important social tech to minimize the amount to which you make it weird.</p>\n<p>Friendmaxxing makes it a lot easier to try to take that leap. If you have one friend and you make it weird, then you might have zero friends. If you have a thousand friends, you have not one friend to spare, but also if you botch things and go down to 999 friends you will be fine.</p>\n<p>One note in the paper is that if you move to friends with benefits, that typically doesn\u2019t lead to long term romantic success. If you want something more, then statistically you need to go straight for it once things get complicated.</p>\n<h4>You\u2019re Single Because You Aren\u2019t Willing To Be Dungeon Master</h4>\n<p>Two strong pieces of advice here.</p>\n<blockquote><p><a href=\"https://x.com/KelseyTuoc/status/1915459533117546827\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Kelsey Piper</a>: I try to stay out of the dating discourse because it&#8217;s obnoxious to hear from happily married lesbians about the state of gender relations but there is such a lane for someone giving advice like &#8216;meet single men by running a killer D&amp;D game&#8217; and &#8216;try getting really into aviation&#8217;</p>\n<p>A lot of people suck at talking about themselves but in fact have deeply felt values and fascinations and if you meet them there, they&#8217;re very very cool. Don&#8217;t give up on really Getting someone, but don&#8217;t try to achieve it by asking them personality questions.</p></blockquote>\n<p>The first half is a gimme. If there is an activity that is popular with the gender you\u2019re looking for, where the people who want to do it are people you would want to date, then running or helping run such an activity is a great idea, even better than simply participating, and actually making it a killer version is even better. I do not think this in any way counts as being \u2018fake.\u2019</p>\n<p>This goes double when combined with the statistics about friends. D&amp;D is the ultimate \u2018make friends first\u2019 strategy.</p>\n<p>The second half is even better. Traditional dating paths require or at least tend to cause a set of strange, awkward conversations about personality and dating. That means the people who are good at navigating that will be in high demand, whereas those who are not as good will struggle. Any way to change the topic into other things shakes that up and puts you in a better spot. It might be a bit slower, but you absolutely get to know people when not explicitly discussing getting to know them.</p>\n<p>Also, do this with your friends. Knowing your friends this way is Amazingly Great, on its own merits.</p>\n<h4>You\u2019re Single Because You Didn\u2019t Listen To My Friend\u2019s Podcast</h4>\n<p>My old friend Ted Knutson has a new podcast called Man Down, which includes at least three episodes on dating. <a href=\"https://www.youtube.com/watch?v=57eaytm2VMA\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">This one is about strategy using dating apps</a> and improving your profile, the first one was <a href=\"https://www.youtube.com/watch?v=IiiVvRX0478\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">more about dating in general</a>, they then followed up with <a href=\"https://www.youtube.com/watch?v=R-oXaWFdHO4&amp;pp=0gcJCX4JAYcqIYzv\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">another on fixing your profile</a>.</p>\n<p>I wouldn\u2019t have listened if I hadn\u2019t had the extra value of watching Ted squirm. The information density from podcasts isn\u2019t great even at faster speeds, although the info that is here seems pretty solid if you don\u2019t mind that.</p>\n<p>There\u2019s a bunch of fun stats to start. The first recommendation is for men to fight on different terrain where they aren\u2019t unnumbered (men outnumber women ~4:1 on Tinder and spend ~96% of the money) or in a bad spot, try in person. But you might fully not have that option so they mostly focus on sharing data and then improving Ted\u2019s dating profile. Women on Tinder swipe right 8% of the time, men swipe right 46% of the time, the average man gets 1-2 matches a week. Hinge\u2019s numbers are less unbalanced (2:1 ratio). They discuss various different apps you can consider.</p>\n<p>Then the Ted squirming part begins and we start on his profile. It\u2019s remarkable how bad it starts out, starting with pictures. Some advice given: Think elegant and sober, charismatic pictures, focus on face, definitely not shirtless unless maybe you\u2019re playing sports, ideally pay to get better photos taken. Save the humor for the prompts and chats and focus answers on the person not the relationship type. Actively study profiles before you message people, customize everything.</p>\n<h4>You\u2019re Single Because You Flunk The Eye Contact Test</h4>\n<p>This seems right.</p>\n<blockquote><p><a href=\"https://x.com/sashachapin/status/1915501101560062448\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Sasha Chapin</a>: There is an eye contact dance that happens in the first few seconds when single men and women meet and if a man flunks it, it\u2019s actually tricky to come back from.</p>\n<p>So my advice to single guys is, become someone who automatically aces it because you feel fundamentally safe in the world.</p>\n<p>[You want to use] whatever pattern of eye contact conveys the message &#8220;I&#8217;m okay with you noticing that I&#8217;m attracted to you, whatever happens next isn&#8217;t a problem for me&#8221; \u2014 not hiding, not grabby, centered, not managing the response on the other end.</p>\n<p>This probably doesn&#8217;t mean unbroken staring unless the other party defaults to intense eye contact.</p></blockquote>\n<p>The question is, is this a \u2018sincerity is great, once you can fake that you\u2019ve got it made\u2019 situation? Or is it easier and more effective to actually be okay with all of this?</p>\n<p>The good news is that it is optimal life strategy to genuinely be okay with whatever happens next so long as no machetes are involved. It is actively good for other people you are attracted to to sense you are attracted to them &#8211; so long as they sense that you\u2019re okay with whatever happens next, and that you aren\u2019t afraid of them knowing.</p>\n<p>The other good news is that you can also pass through practice, even if you\u2019re not fully genuinely okay with whatever happens next short of machetes.</p>\n<h4>You\u2019re Single Because The Women Don\u2019t Hit On The Men</h4>\n<p>Bryan Caplan\u2019s polls are mostly answered by men, so:</p>\n<div class=\"captioned-image-container\">\n<figure>\n<div class=\"image2-inset\">\n<p><img alt=\"\" class=\"sizing-normal\" height=\"343.98230088495575\" src=\"https://substackcdn.com/image/fetch/$s_!-_FS!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F38593650-809c-4a94-b38b-b7aebb8b43d9_1130x598.png\" title=\"\" width=\"650\" /></p>\n<div></div>\n</div>\n</figure>\n</div>\n<p>There was essentially no interaction between the variables. About 85% of those in both groups wanted to be hit on more rather than less. Even when it\u2019s an automatic no, you know what, it\u2019s nice to be asked.</p>\n<blockquote><p><a href=\"https://x.com/hollowearthterf/status/1919188390160761325\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">RFH Doctor</a>: I love how girls will never tell a man she\u2019s interested in him, instead they send secret signals through tweets, instagram stories, brain waves, magic rituals, and prayers, ancient feminine wisdom that ensures only men who are in tune with the unconscious will be selected.</p>\n<p>Dr. Jen Izaakson: Also can I just say, as a lesbian, the subtle signals women send are hardly a difficult set of hieroglyphics to decode. What men find especially difficult is not only the reading of the signs, but also not overstepping or not taking the route she wants in the pursuit. Yes this woman likes you, but she doesn\u2019t want you to escalate proximity beyond her pace. Men need to learn to drive the wheel exactly how the map holder suggest.</p>\n<p>Napoleonos: Literally anything except telling him.</p>\n<p>RFH: I love that for us &lt;3</p></blockquote>\n<p>So, you seem to be saying \u2018shit test\u2019 like that\u2019s a bad thing\u2026</p>\n<blockquote><p><a href=\"https://x.com/eigenrobot/status/1919415518114582689\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">eigenrobot</a>: men often misinterpret this as a &#8220;shit test&#8221; or something but in fact a potential partner&#8217;s ability to read her mind is a completely reasonable selection criterion for women to prioritize.</p>\n<p>and &#8220;I am falling over myself to psychically telegraph that i am interested&#8221; is easy mode!</p>\n<p>all you have to do is _pay attention_ to women and what they&#8217;re doing and be marginally reflective about it</p>\n<p>easy top three highest ROI skill available to young men</p>\n<p>corsaren: Too many men treat it as a crazy demand, but not only is partner mind-reading totally doable if you have a strong bond, it\u2019s also very fun once you get good at it. Bonus: once you prove that you can read her mind, she\u2019ll be more likely to explain in the times when you can\u2019t.</p></blockquote>\n<p>There\u2019s nothing inherently bad or inefficient about a shit test. This is very clearly a (very standard) shit test. Anything that could be described by the phrase \u2018not f***ing telling you\u2019 is either a ghosting or a shit test. It\u2019s selection and information gathering via forcing you to correctly respond to an uncertain situation, which here involves both \u2018figure out she\u2019s interested\u2019 and also \u2018actually act on it\u2019 and doing that in a skilled fashion.</p>\n<p>Which has some very clear positive selection effects. But it also has a clear negative selection effect for \u2018men who go around hitting on everyone a lot\u2019 and against men who are (very understandably and often for good reasons) risk averse about making such a move.</p>\n<p>It is my understanding is that as things have shifted, with more men being afraid to open either in general or to anyone they already know, this is making a lot less sense as a filter.</p>\n<p>The problem with not doing so is you are filtering a lot less for ability to detect attraction and mind reading, and far more for those who have norms that involve hitting on a lot of women. Which is a far more mixed blessing. You\u2019re going to fail on a lot more otherwise desirable connections than you would have in the past.</p>\n<p>A man being unwilling to make a first move simply isn\u2019t a strong negative sign at this point. Indeed, if they are capable of navigating subsequent moves it could even be a positive sign, because this is how they didn\u2019t get removed from the market.</p>\n<p>Also I am pretty sure the other downsides of being too forward are way down from where they used to be. That is especially true if they are unwilling to (essentially ever) make the first move, which means they\u2019re likely to very much appreciate it when you do so instead (and if they don\u2019t, then the combination is a big red flag). Thus, I think being forward (as a woman seeking men) is a far better strategy than it was in the past.</p>\n<h4>You\u2019re Single Because When A Woman Did Hit On You, You Choked</h4>\n<p><a href=\"https://x.com/CartoonsHateHer/status/1918466986557751340\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">If someone runs a TikTok experiment</a> where a woman hits on men out of the blue, do you get points for being smooth and trying to capitalize on it, or points for correctly suspecting it\u2019s not real?</p>\n<blockquote><p>Richard Hanania: Fascinating social experiment here. Watched the whole thing. You can see the variation in men\u2019s confidence and the differences are absolutely vast. Best performing was black guy in black tank top, the worst was the first guy. Just completely different levels of being able to capitalize on an opportunity.</p>\n<p>I looked at the replies finally, so many of you are so pathetic. You should have a positive attitude and even if it&#8217;s a skit there&#8217;s still opportunity there. You could win her over or could even impress others in the vicinity! At worst you can practice talking to an attractive woman. And you shouldn&#8217;t walk around with an attitude of nothing good can ever happen to me anyway.</p>\n<p>I just keep being shocked by how unworthy of existence many of you are. It was outside my realm of imagination. Now I know what women feel. You all think like this and think you deserve companionship or even to live.</p>\n<p>Cartoons Hate Her: Most men are hit on so rarely that the ones who aren\u2019t top-tier attractive immediately know something is going on lol. You can see them looking for whoever is filming.</p>\n<p>Side note: I had no idea it was this easy to hit on men. I have never approached a man, I found it unbecoming. I can see why men are afraid of it.</p>\n<p>Richard Hanania: It\u2019s a self-fulfilling prophecy.</p>\n<p>Cartoons Hate Her: True.</p>\n<p>Armand Domalewski: The way she does it is so obviously fake lol</p>\n<p>It\u2019s a guy\u2019s idea of how a girl would hit on a guy.</p>\n<p>Lazy River:</p>\n<p>&gt;guy thinking &#8220;this has to be fake&#8221;</p>\n<p>&gt;it is in fact fake</p>\n<p>Birth of another super villain. This happens to guys fr while the girls friends laugh in the back ground and it takes them out of the game for years, sometimes the rest of their lives. And it is this easy to pick up a man.</p>\n<p>David: They\u2019re objectively correct that there\u2019s a camera tho, that\u2019s not them being stupid for lacking confidence they are 100% right that she\u2019s not to be trusted.</p>\n<p><a href=\"https://x.com/robkhenderson/status/1918457352769917401\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Rob Henderson</a>: Reminds me of a study years ago where researchers had attractive actors to go up to people on a college campus and ask if they\u2019d like to go on a date with them, if they\u2019d like to go back to their apartment with them, and if they\u2019d like to go to bed with them.</p>\n<p>For women, 56% said yes to the date with the attractive male stranger, 6% said yes to going back to his apartment, and zero said they would go to bed with him.</p>\n<p>For men, half said yes to the date with the attractive female stranger, 69% said yes to going to her apartment, and 75% said yes to going to bed with her.</p></blockquote>\n<p>If you know you\u2019re being filmed that\u2019s all the more reason to go for it? Same principle as before, if they post it and it gets views you identify yourself and say DMs are open.</p>\n<p>All the men in the video did successfully exchange contact information of some form. Rob Henderson and Richard Hanania then did a 20 minute analysis of the 5 minute video, critiquing the various responses to see who got game and who didn\u2019t.</p>\n<p>They pointed out correctly that the percentage play, if you have the option and you are actually interested and think this could be real, is to attempt escalation to a low investment date on the spot, and go from there, while she\u2019s feeling it.</p>\n<p>The other great point is, no it isn\u2019t real by design, but who is to say you cannot make it real? She\u2019s opening. She\u2019s giving you an opportunity. Sure, she might intend it to purely be a bit, but if you play your cards right, who knows? Worst case scenario is you get an extra rep. It\u2019s even a power move to indicate you know she thinks it\u2019s fake, and to run right through that.</p>\n<p>I would add that the men here all now have her contact information, and there is nothing stopping them from extending the experiment. As in, you say \u2018I know that your approaching me was a bit for a video, but I do like you, so\u2026\u2019 and again worst case is she tells the world you tried to have some game. Even now, there\u2019s still time, guys.</p>\n<p>Also, of course, yes women can basically do this at will, and there are strong arguments that they should be approaching quite a lot, as they have full social permission to do so, and even when you get a no you probably brighten the guy\u2019s day &#8211; almost all guys consistently say, as noted above, they want to be approached more. And as I noted above, \u2018guy is willing to open\u2019 is not a great selection plan in 2025.</p>\n<h4>You\u2019re Single Because You Don\u2019t Know The Flirtation Escalation Ladder</h4>\n<p>Even basic flirting principles are in short supply so it\u2019s worth going over this again, starting from the top.</p>\n<blockquote><p><a href=\"https://x.com/chaseaustin888/status/1948487215283130585\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Chase Harris</a>: If you subtly flirt with every woman you come across and say wassup bro in a happy mood to random dudes you will go far in life. Everyone is like a kid trapped in an adult body. They just want compliments and friends, so be that. You\u2019ll never spend a day broke or alone if you do.</p></blockquote>\n<p>Standard Deviant offers us <a href=\"https://casualsex.substack.com/p/the-escalation-ladder\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">The Escalation Ladder</a>. The flirting examples are sometimes weird and strangely ordered, but the principles are what is important and seem entirely correct. Indeed, the very fact that the details seem off yet this is still the person writing the post illustrates that the principles are what matters.</p>\n<p>The basic principles are:</p>\n<ol>\n<li>Start at a level appropriate to the context.</li>\n<li>Escalate slowly.</li>\n<li>Actively de-escalate unless they escalate back.\n<ol>\n<li>When dealing with a sufficiently clueless dude you can relax this a bit.</li>\n</ol>\n</li>\n<li>Don\u2019t escalate if you think either of you would regret it later.</li>\n<li>Understand when you are entering the \u2018warning zone\u2019 where you can no longer fully pretend you maybe aren\u2019t flirting at all, where you thus risk making someone actively uncomfortable or causing an actively negative reaction.</li>\n<li>Understand when you are entering the \u2018danger zone\u2019 where you can get yourself or someone else into real trouble.</li>\n<li>It is very hard to disguise your level of being sexually pushy, which means that being actually not that pushy is the correct move on all levels.</li>\n</ol>\n<p>Some notes on the specific actions:</p>\n<ol>\n<li>They correctly identify that \u2018asking if I can make a flirtatious comment\u2019 is a larger escalation than actually making the flirtatious comment. I think he misidentifies the reasoning here, it\u2019s not that this implies a \u2018more flirtatious\u2019 comment, it\u2019s that asking makes your action not ambiguous and is requesting a non-ambiguous escalation.</li>\n<li>I also think that asking for someone\u2019s number without a plausible other reason (aka \u2018closing\u2019) should be much farther down the list than they have it. If the action is clearly in a dating context this is in the warning zone. But with a good enough excuse it isn\u2019t even flirting. High variance.</li>\n<li>Telling a joke can certainly be flirting but if the joke isn\u2019t risque it\u2019s a free action, fully deniable and ambiguous, you can do this pretty much at any time.</li>\n</ol>\n<p><a href=\"https://www.cartoonshateher.com/p/oops-we-forgot-some-women-like-flirting\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Flirting is pretty awesome</a>. Alas, flirting seems to be getting rare and men are afraid to do it. The perception here has little basis in reality, but fear of tail risk (or in some cases, thinking it\u2019s not even a tail risk) works whether or not the thing you are afraid of is real.</p>\n<blockquote><p>Cartoons Hate Her: But increasingly, I see young men claiming that they\u2019re afraid to flirt with women in social settings, even at bars or parties, because the woman could \u201cruin their lives.\u201d I saw one insisting that there\u2019s a 50% chance any woman you approach will send you to jail. I think (or at least, I <em>thought</em>) most men know that women won\u2019t <em>really</em> ruin their lives for talking to them at a club.</p>\n<p>The worst thing that will happen is rude rejection and ridicule, which sucks for a bunch of other reasons (I\u2019d have a hard time with that if it happened to me!) but isn\u2019t life-ruining. And as any established pickup artist will tell you, the key to success is to lose the fear of rejection, and that happens when you see it all as a low-stakes numbers game.</p></blockquote>\n<p>Obviously she is correct, unless you are doing something very wrong in a way that should be rather obvious, you use a reasonable escalation ladder and you take no for an answer, the chance of a woman you approach trying to \u2018run your life\u2019 let alone \u2018send you to jail\u2019 is epsilon.</p>\n<blockquote><p><a href=\"https://x.com/CartoonsHateHer/status/1946606212457398440\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Cartoons Hate Her</a>: The young women today who are upset that men don\u2019t approach them aren\u2019t the same women who decided any approach was harassment in 2015. We don\u2019t all attend an annual bitch conference.</p>\n<p>I recall getting yelled at in the Jezebel comments section in like 2014 bc I said it\u2019s not bad for a man to come onto a woman if he respects a \u201cno.\u201d We existed back then and people told us to shut up!</p>\n<p>I actually don\u2019t think a fear of women calling the cops is the problem. Making overtures in person (like I wrote here, about dancing) is far more risky re: embarrassment and rejection than simply doing nothing or staying on apps.</p>\n<p>I feel like it\u2019s very silly to conflate \u201cI don\u2019t want to be stalked or assaulted\u201d with \u201cmen should never flirt with me.\u201d Thinking the latter is silly doesn\u2019t mean you think the former is silly. These should be totally different things.</p>\n<p>If all women, or even all liberal women, are to blame for a few overzealous takes in 2013, then by that logic it\u2019s reasonable to treat all men as assaulters because some of them are. Get real.</p></blockquote>\n<p>The problem is, the extreme was loud, and looked to many young men like the norm.</p>\n<blockquote><p><a href=\"https://x.com/CartoonsHateHer/status/1946573611373867284\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Kat Rosenfeld</a>: hard to overstate how much the culture has been shaped by the fact that circa 2011 sites like Jezebel\u2014and, subsequently, the discourse \u2014 were overtaken by millennial women with personality disorders and/or intense grudges over the romantic disappointments they suffered as teens.</p>\n<p>Cartoons Hate Her: Drives me nuts when people assume I (or even the majority of women) were complicit in this nonsense. Most people just didn\u2019t want to be assaulted lol. Predictably, the wackos ruined it for everyone.</p>\n<p><a href=\"https://x.com/caesararum/status/1946592309790806027\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Caesaraum</a>: what percent of people being wackos ruins the commons for everyone? how much discourse does it take to make the wackos look more prevalent than they are?</p>\n<p>Isabel: It is dawning on me just how non-flirtatious our world is. When two people start flirting in front of me in public I feel like I\u2019m witnessing something precious and start rooting for it to go somewhere. It feels so rare now. What happened? We like to talk to each other, remember?</p>\n<p><a href=\"https://x.com/fitnessfeelingz/status/1864489097479193041\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">My Fitness Feelings</a>: Women will literally start a global witch hunt against flirting. Successfully destroy it. Forget. Then start a new movement complaining that no one is hitting on them.</p></blockquote>\n<p>Alternatively, the message that went out was \u2018do the wrong thing and we will rain hell down upon you\u2019 and even though this was rare even when the man deserved it or worse, and far rarer when they didn\u2019t, there were a few prominent examples of this happening in ambiguous cases, so the combination created a culture of fear. To which some said good and they amplified it.</p>\n<p>Then this synthesized into a culture obsessed with smartphones and dating apps, to the point where interactions in physical space seem alien and bizarre, and any kind of flirting or similar behaviors in person seemed verboten.</p>\n<p>As always there is an alternate hypothesis, which it seems is both that there is no problem, and that the problem is the fault of the apps or porn:</p>\n<blockquote><p><a href=\"https://x.com/dhaaruni/status/1946633181773627751\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Dhaaruni</a>: The \u201cmen can\u2019t approach women anymore because of man-hating feminists\u201d stuff is very overblown. I\u2019m more of a misandrist than ~99% of women and when I was single, men would approach me, and I was usually amenable to engaging! But, normal human behavior doesn\u2019t drive discourse.</p>\n<p><a href=\"https://x.com/Noahpinion/status/1946809335814017126\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Noah Smith</a>: Yes. To the extent that men don&#8217;t approach women anymore, it&#8217;s because they&#8217;re either on apps, or gooning to porn. The idea that wokeness has turned men into a bunch of timid feminist wimps is just another dumb online panic.</p></blockquote>\n<h4>You\u2019re Single Because You Will Actually Never Open</h4>\n<p>The most obvious place to start is, if she\u2019s talking to you for a remarkably long time, you don\u2019t want to make any assumptions but you (assuming you are interested yourself) do want to at least try flirting a bit and seeing if she\u2019s interested?</p>\n<blockquote><p><a href=\"https://x.com/holy_schnitt/status/1945657988582453403\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Ellie Schnitt</a>: my very sweet friend did not realize that the girl who was talking to him for 2 hours at a party last weekend was interested. I want to reiterate they spoke for 2 entire hours and he didn\u2019t realize she wanted to kiss him until he was told 10 minutes ago.</p>\n<p>in his defense a few years ago I talked to a guy I was VERY into for hours just assuming he wasn\u2019t interested. At the end of the night he said \u201cI\u2019m going home, you coming?\u201d and I said \u201coh is there an after party?\u201d I\u2019ll never forget the look he gave me I think I broke his brain.</p>\n<p><a href=\"https://x.com/doxntme/status/1946051080850227660\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">NeedMeAJinsh</a>i: Holding a conversation for 2 hrs is literally nothing. Not to be that guy, but trying to make &#8220;holding a conversation&#8221; a sign of interest is exactly how you make every guy think a girl showing him basic respect is her hitting on him.</p>\n<p>Eva: protect him at all costs tbh.</p>\n<p>Ellie Schnitt: He is the sweetest and deserves the world.</p>\n<p>Wayne Reardon: Story of my life. When i was 26 I walked a girl home one night and when we were sitting on the porch out the front of her house I asked her &#8220;what are you doing for the rest of the night?&#8221;.</p>\n<p>She answered &#8220;I&#8217;ll probably watch a movie. It&#8217;s called Who&#8217;s Going To Make The First Move&#8221;.</p>\n<p>I didn&#8217;t figure it out until about 2 hours later, so rang her and went back to her house.</p>\n<p><a href=\"https://x.com/keysmashbandit/status/1946245579815649458\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Keysmashbandit</a>: Female sexual attraction is a myth. There is no behavior that could possibly communicate it. No matter what, she&#8217;s not interested. Don&#8217;t bother.</p>\n<p>Even if a woman is having sex with you she&#8217;s only doing it so she can make fun of you with her friends later. Even if you&#8217;re dating. Even if you&#8217;re married with children.</p>\n<p>Keysmashbandit (replying because it seemed necessary): This post is obvious sarcasm and if you believe it at face value even for a second you need to exit your house immediately and talk to another human face to face.</p></blockquote>\n<p>The concern of NeedMeAJinshi is real, which is why you gracefully check. Talking for two hours at a party goes well beyond basic respect and you should definitely check.</p>\n<p>At least be less oblivious than this guy.</p>\n<blockquote><p><a href=\"https://x.com/AstrosBrain/status/1949819362237411654\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Brian</a>: In college I had a female friend who was really cute and I got along with really well. I never asked her out. We were friends! It just never occurred to me.</p>\n<p>I drew a daily comic at the time. At some point, I introduced a character, who looked like her, whose name was similar, and who was the main character\u2019s best friend. The running joke was that she had a massive unrequited crush on him but the guy was completely oblivious.</p>\n<p>I later found out that she actually had a big crush on me and I was, in fact, completely oblivious. She read my comics and must have thought I was torturing her.</p></blockquote>\n<h4>You\u2019re Single Because We Let Tinder Win</h4>\n<p><a href=\"https://www.aeaweb.org/articles?id=10.1257/app.20240455&amp;from=f\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">A new paper</a> covers what happened when Tinder first arrived, note that this was largely a replacement of other dating apps.</p>\n<blockquote><p>Online dating apps have transformed the dating market, yet their broader effects remain unclear.</p>\n<p>We study Tinder\u2019s impact on college students using its initial marketing focus on Greek organizations for identification. We show that the full-scale launch of Tinder led to a sharp, persistent increase in sexual activity, but with little corresponding impact on the formation of long-term relationships or relationship quality. Dating outcome inequality, especially among men, rose, alongside rates of sexual assault and STDs.</p>\n<p>However, despite these changes, Tinder\u2019s introduction did not worsen students\u2019 mental health, on average, and may have even led to improvements for female students.</p></blockquote>\n<p>The full paper is gated, and one must note the unavoidable limitations here. Greek organizations are importantly different from others, and the real difference is that the early dynamics are not going to hold stable over time, and with this kind of study you are not going to see longer term effects.</p>\n<p>In terms of \u2018mental health,\u2019 the short term effects are reported (presumably self-reported) to be neutral-to-good in aggregate, and the net relationship impacts tiny. Given the other impacts I would presume that the longer term mental health impacts are negative, and for college students to be a group where the net effects are relatively positive.</p>\n<h4>You\u2019re Single Because The Apps Are Bad On Purpose To Make You Click</h4>\n<p>Periodically we see a version of this claim:</p>\n<blockquote><p><a href=\"https://x.com/croissanthology/status/1930497352072147120\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Medjedowo</a>: dating apps, by nature, can&#8217;t be &#8216;too effective&#8217; at matching users, otherwise they&#8217;d run out of customers and traffic volume.</p>\n<p>Not to be too conspiratorial but how are they incentivizing long term usage, exactly? like the users meet irl but they stacked the deck to sabotage it behind the scenes? as with news media reporting slop my inclination is to ultimately blame the consumers&#8211; if they could sell.</p></blockquote>\n<p>I mean, yes, in theory at some point this becomes true. At any reasonable margin this simply isn\u2019t true, certainly not for anyone outside of Match group. The reputational effects swamp everything else, especially since even if you are 100% to get a successful match most relationships don\u2019t last. You\u2019ll be back, and if you aren\u2019t you\u2019ll be telling all your friends how you met.</p>\n<p>You do want to somewhat sabotage the lives of free users to force them to pay,and thus you gate useful things behind paywalls, but that\u2019s true of essentially all free apps everywhere to some degree.</p>\n<h4>You\u2019re Single Because You Present Super Weird</h4>\n<p>Having nerdy interests is only a minor handicap, if you (1) own it with no stress and (2) don\u2019t require or impose them on your partners or let them get in the way. Chances are high your actual problem to fix lies elsewhere.</p>\n<p>If someone actually vetoes you because of your hobby even if you own it with no stress and no imposition of it on others, it wasn\u2019t a good match anyway. That\u2019s positive selection right there. The same goes for political vetoes.</p>\n<p>This conversation started off with the (decent looking) <a href=\"https://t.co/OT4GrBLNbi\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Guy Who Swiped Right Two Million Times and got one date</a>. Ten out of ten points for persistence and minus several million for repeating the same action expecting different results and also minus another million for having actual zero swiping standards.</p>\n<p>He\u2019s plausibly got requirement one nailed but number two might be a problem.</p>\n<div class=\"captioned-image-container\">\n<figure>\n<div class=\"image2-inset\">\n<p><img alt=\"\" class=\"sizing-normal\" height=\"356.9937369519833\" src=\"https://substackcdn.com/image/fetch/$s_!635W!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2d126022-5c28-4ba2-a245-7b17ddb3c63b_958x1125.jpeg\" title=\"\" width=\"304\" /></p>\n<div></div>\n</div>\n</figure>\n</div>\n<p>The problem clearly ran deep. It\u2019s one thing to do 2.05 million swipes and get only 2,053 matches. That\u2019s 1 in 1,000, which to be fair is very bad, and it\u2019s not hard to generate theories as to how that happened. But then he had 1,269 chats and that led to 1 date, and at that point dude it\u2019s something else entirely.</p>\n<blockquote><p>Max: I think he\u2019s just scary.</p></blockquote>\n<p>The contradictions are there right off the bat. He does have standards, in his way.</p>\n<blockquote><p><a href=\"https://x.com/mojishakenbake/status/1924135570042683732\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Goblin</a>: i think ultimately this is a branding issue tbh</p>\n<p>Fish photos signal &#8220;conservative normie,&#8221; owning 33 snakes signals &#8220;weirdo leftie.&#8221;</p>\n<p>Basically no one making it through his photo filter survives his special interest filter.</p></blockquote>\n<p>I don\u2019t think that\u2019s weirdo lefty, you can totally have 33 snakes and be a weirdo rightie. Claude suspects \u2018trying too hard to be quirky,\u2019 which definitely fits.</p>\n<blockquote><p>Sardine Thief: I think he&#8217;s just weird and antisocial and from what I&#8217;ve seen floating around of the rest of his profile acts vaguely menacing and domineering, u can literally have whatever weird interest you want and the right girl will find it charming if you&#8217;re not otherwise a weirdo</p>\n<p>i used to think i was basically this guy and was doomed bc of my &#8220;weird&#8221; interests in like historical asian linguistics and comparative religion and when i reframed it as a &#8220;me&#8221; problem instead of a &#8220;my interests&#8221; problem i met a woman who actually likes me like a month later</p>\n<p>Goblin: oh wow wait what what can you elaborate this is a really good case study</p>\n<p>Sardine Thief: i had the typical nerdy guy problem of thinking it was my nerdy interests that made women not interested and not that very same self-pitying attitude</p>\n<p>i don&#8217;t think that&#8217;s specifically this guy&#8217;s problem but &#8220;my interests are unlovable&#8221; is often a smokescreen to protect the ego from having to address what the real problem is, because saying &#8220;i need to work on how i relate to and communicate with women&#8221; and then doing it is a lot harder than saying &#8220;they don&#8217;t like me cuz they hate my snakes&#8221;</p>\n<p>my problem was actual gynophobia, i spent most of my life til ~19 being emotionally/verbally abused by female caregivers &amp; had to work out some things to be able to not treat women like &#8220;landmine that needs to be placated with chores and fawning to maybe not blow up in my face&#8221;</p>\n<p>Goblin: oh whoa yeah that makes a lot of sense! good on ya for working it out! this feels like a v common path but people end up getting stuck at the &#8220;nobody likes my weird interests&#8221; point</p>\n<p>Sardine Thief: yeah, it does loop back around to branding, but reinventing your branding on more than a surface level requires deeply examining the pillars that the way you present yourself are built on to begin with</p>\n<p>Goblin: Yeaaah!</p></blockquote>\n<p>At most, you get one move at this level. You definitely don\u2019t get two.</p>\n<h4>You\u2019re Single Because You Have The Wrong Hobbies</h4>\n<p>The broader point is mostly right, the narrow point seems obviously wrong?</p>\n<blockquote><p><a href=\"https://x.com/yashkaf/status/1950680658113651110\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Jakeup:</a> If fewer than one third of men are into comic books (likely) or cosplay (almost certainly), then getting into comic books or cosplay increases your market attractiveness.</p>\n<p>The broader point isn&#8217;t just that many &#8220;unattractive&#8221; traits are undersupplied and thus are actually good, but that being *anything at all* is attractive the only thing oversupplied in the dating market are people who are nothing in particular and do little much of anything.</p>\n<div class=\"captioned-image-container\">\n<figure>\n<div class=\"image2-inset\">\n<p><img alt=\"\" class=\"sizing-normal\" height=\"519.9707207207207\" src=\"https://substackcdn.com/image/fetch/$s_!733I!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc57b4018-d19c-45cc-b860-7c48b800d202_888x1118.jpeg\" title=\"\" width=\"413\" /></p>\n<div></div>\n</div>\n</figure>\n</div>\n</blockquote>\n<p>In general, yes, better to be into as many non-harmful things as you can, so long as you are capable of shutting up about them and not letting them interfere with your dating activities. The reason so many of the things here are unattractive is that they do actively interfere, either because people can\u2019t stop talking about them, they are money sinks, they have very bad correlations, or they do active harm to you, or a combination thereof.</p>\n<p>You definitely can\u2019t say that if X% of women find [Y] attractive, then at least X% of men should have attribute [Y], or vice versa, or that this indicates undersupply if not true, or anything like it. That\u2019s not how it works for various obvious reasons.</p>\n<p>But yes, if you are not into some things, you need to pick at least one something and get into it, ideally something that people you are interested in will find interesting.</p>\n<h4>You\u2019re Single Because You Do The Wrong Kind Of Magic</h4>\n<p>Why is (illusionary) magic <a href=\"https://x.com/ChanaMessinger/status/1930652956992434286\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">considered lame and low status</a>? I am with Chana Messinger here that if executed and presented well, magic gives you charm and charisma, and seems great at ice breaking and demonstrating skill and value, and is actually great.</p>\n<p>I also think Jack is correct that most people who use magic in this way are bad at it, and that bad magic is indeed lame and low status. Most magicians are not successful, and most people presenting magic are showing that they\u2019ve overinvested in magic relative to other things. So is being \u2018too in\u2019 in magic as a strategy relative to your level of magic success.</p>\n<p>There is especially a problem if you are obviously doing the magic as a strategy to get girls, doubly so if you are shoehorning your magic into an interaction where it shouldn\u2019t be, or if you present as if you think you\u2019re super hot stuff when you clearly aren\u2019t. Having magic available as a tool is awesome, if you have some skill, but part of making the magic happen is knowing when not to make the magic happen.</p>\n<p>The other problem is that illusionary magic (unlike magick or Magic: The Gathering) is at its core illusion and deception. Do you want to make that your brand? What other kinds of scams are you trying to pull?</p>\n<h4>You\u2019re Single And All That Rejection Really Sucks</h4>\n<p>It\u2019s easy to get caught up in \u2018how to play correctly\u2019 and the fact that you can indeed succeed on the apps with effort, and forget that even in the best case all that rejection is going to feel really terrible if you let it.</p>\n<blockquote><p>veloread: Honestly, I had to quit Bumble for years because of what it did to me. More than any other dating app, on Bumble I have had an awful time.</p>\n<p>My experience was \u2013 and to a lesser extent, remains, now that I\u2019m on it again \u2013 this:</p>\n<p>Set filters to the people I\u2019m interested in. See profile after profile of fascinating, funny, intelligent-seeming people who are my type. Think to myself about whether we\u2019d be compatible. Swipe, in the absolute and extreme confidence that I won\u2019t get a match. Don\u2019t get any matches.</p>\n<p>That constant rejection \u2013 person after person after person \u2013 and the few times you match, and you find the other person just doesn\u2019t put in any effort at all, because, well, the gender ratio and dynamics on these apps is awful, and so she\u2019s got a huge pile of matches and messages to deal with.</p>\n<p>The experience made me angry, and it made me sad. I went on these apps after a breakup, hoping that I\u2019d be able to \u201cput myself out there\u201d, but it ended up making the pain of that loss much worse. I had thought, because of who I had been with \u2013 and because our relationship ended not because of anything either of us did, but because we were at different stages of our lives \u2013 that I was handsome and funny and desirable. That I\u2019d come off as someone people would like to talk to, laugh with, have adventures with.</p>\n<p><a href=\"https://x.com/signulll/status/1937977952064471408\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Signull:</a> people ask how i stay attuned to what tech actually does\u2026 the emotions it triggers, the ways it shapes lives, the subtle effects or unexpected magici it delivers. the answer\u2019s simple. i read. not whitepapers. not founder threads. this. stuff like this.</p>\n<p>posts like this are where the truth lives. visceral, unpolished, &amp; real. someone trying to make sense of their own pain through a product that promised connection but delivered emptiness. this is user research. this is culture listening.</p>\n<p>the internet gives you a front row seat to the human condition. you just have to care enough to look.</p>\n<p>Rany Treibel: I love these kind of posts because they&#8217;re vulnerable in a productive way, not attention seeking, not acting like a victim, just sharing an experience. Could this person do things better? sure, but that doesn&#8217;t matter here. Even those of us who have no trouble on dating sites still experience this for weeks on end sometimes.</p>\n<p><a href=\"https://x.com/robinhanson/status/1938200976835444739\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Robin Hanson</a>: I gotta say this wouldn\u2019t have done much for my mental health either. Pretty dystopian hell scenario.</p></blockquote>\n<p>The obvious mental trick, far easier said than done, is to not see this as rejection.</p>\n<p>As in, you\u2019re not being rejected so much as not being considered. You\u2019re not making a request so much as you\u2019re confirming you would be open to something happening.</p>\n<p>The algorithm is gating your success behind a bunch of grinding, until someone takes the time to consider you enough to have meaningfully rejected you rather than a photo, to have chosen to reject rather than not have had time to choose at all. And it is only once someone engages you in conversation for real that you\u2019ve actually been rejected as a person.</p>\n<p>Until then, yes you should be aware of your metrics versus others so you can work on improving, but in a real way this \u2018doesn\u2019t count.\u2019</p>\n<h4>You\u2019re Single Because Dating Apps Are Designed Like TikTok</h4>\n<p>Would this feature work?</p>\n<blockquote><p><a href=\"https://x.com/oscredwin/status/1937894629837312087\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Andrew Rettek</a>: Idea for a dating site feature. Every time you swipe on someone you need to write a little bit about why before you can swipe again/message that match. That feedback is collected for every user and every user can request an LLM summary of it (but not the actual text).</p>\n<p>This adds friction to slow down mindless swiping, gives users (successful and unsuccessful) feedback if they want it, and forces people to think at all about what they&#8217;re looking for in a match. I don&#8217;t thing this solves &#8220;the apps&#8221; but it probably helps a bit.</p></blockquote>\n<p>The obvious problem with this is that users don\u2019t want to do this. The point of swiping is that it is almost instant, it requires no thought, no words, like a slot machine. That wins in the marketplace because that\u2019s what women choose.</p>\n<p>So most users, most importantly most women, will quickly start to use the cut and paste, or something damn close to it. I mean, if you\u2019re swiping on a profile, is there really that much to say there, and if they aren\u2019t even going to read it before deciding why should you spend the effort? \u2018Not hot\u2019? In general, you can\u2019t have mechanisms at odds with the user like this.</p>\n<p>The variant of this that has non-zero chance of working is that the man would swipe and write a message first, and only then does the woman get to swipe, and perhaps you would have an AI that would give it a uniqueness score relative to other messages the same person sent, or you would otherwise engage in an auto-filter on the message along with everything else that is available for an LLM to filter profiles.</p>\n<p>The first major dating site to get AI and usefully costly signaling properly into the early matching process, in a way that actually fixed the incentives without wrecking the experience, is going to see some big returns. It\u2019s odd how little they seem to be focusing on this problem.</p>\n<p>Alternatively, what about <a href=\"https://flowingdata.com/2025/06/26/matching-potential-partners-based-on-browser-history/\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">matching people by browser history</a>? If there is a way to avoid data security and privacy concerns (ha!) then there are actually a lot of advantages. This should match people by various forms of common interests and content consumption patterns.</p>\n<p>It also serves as a way to effectively say things you couldn\u2019t otherwise say. As in, suppose you have a very niche interest, perhaps a kink and perhaps something else. You wouldn\u2019t want to put that information in a profile, but this can potentially work around that.</p>\n<p>That suggests a different design, which is AI-only honest-request blind matching.</p>\n<p>As in, you write down what you really, truly want and care about. All the really good stuff. A document you would absolutely not want anyone else to read, including both freeform statements and answers to a range of questions.</p>\n<p>Then, an AI looks at this, and compares your requests and statements to those of others, and gives compatibility scores, in a way that is protected against hacking the system in various ways (e.g. you don\u2019t want someone to be able to add and remove \u2018I\u2019m extremely into [X]\u2019 from their profile and compare all the scores, thus revealing who is exactly how into or not into [X].)</p>\n<p>You could also offer this evaluation as a one-time service, where a fully anonymized server can take any given two write-ups [X], [Y] from different sources, and then evaluate.</p>\n<p>Also note this does not have to be romantic. You can also do this, at scale or one-on-one, for finding ordinary friends or anything else.</p>\n<h4>You\u2019re Single And Here\u2019s Aella With a Tea Update</h4>\n<blockquote><p><a href=\"https://x.com/Aella_Girl/status/1953697198446981364\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Aella:</a> Finally got on Tea. I don&#8217;t think most of you guys have to worry</p></blockquote>\n<h4>You\u2019re Single Because You Don\u2019t Have a Date Me Doc</h4>\n<p>I continue to think having a Date Me Doc, which is literally a document that lays out at length who you are, what you bring to the table and what you\u2019re looking for at length, is an excellent move.</p>\n<p>Here\u2019s a resource that seems worth getting in on, if you\u2019re in the area and the right Type of Guy sufficiently to qualify. This seems like The Way, it only works if you don\u2019t know what she\u2019s writing down:</p>\n<blockquote><p><a href=\"https://x.com/gptbrooke/status/1926308510393856214\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Brooke Bowman</a>: The girlies would like to browse the database.</p>\n<p><a href=\"https://x.com/Actualwebutante/status/1926297562492948618\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Social Soldier</a>: hey guys, if you want to go in the bachelor&#8217;s database lmk. If I know you, I will screen you and put you in for the girlies to see. Sorry, no, you won&#8217;t get to know what I say.</p>\n<p>If you know of any bachelors this is what I\u2019m looking for I like em intense.</p>\n<div class=\"captioned-image-container\">\n<figure>\n<div class=\"image2-inset\">\n<p><img alt=\"\" class=\"sizing-normal\" height=\"739.3939393939394\" src=\"https://substackcdn.com/image/fetch/$s_!Y5IL!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff78a776d-49d6-4ea2-9bd9-df96114f9a83_693x1200.jpeg\" title=\"\" width=\"427\" /></p>\n<div></div>\n</div>\n</figure>\n</div>\n<p><a href=\"https://x.com/catehall/status/1925222388331147579\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Cate Hall</a>: I can\u2019t get Nan to do a date-me so fellas take note that she is SINGLE, WARM, FEROCIOUS, HOT AS HELL, and INTO NERDS.</p>\n<p><a href=\"https://x.com/nanransohoff\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">Nan Ransohoff</a> (<a href=\"https://www.nanransohoff.com/\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">website</a>): well I asked claude what historical figures he\u2019d set me up with and I.. have never felt so seen?</p>\n<p>anyway, I\u2019ll be hosting a feynman lookalike party later this year <img alt=\"\u270c\ud83c\udffc\" class=\"wp-smiley\" src=\"https://s0.wp.com/wp-content/mu-plugins/wpcom-smileys/twemoji/2/72x72/270c-1f3fc.png\" style=\"height: 1em;\" /></p></blockquote>\n<h4>You\u2019re Single Because You Didn\u2019t Hire a Matchmaker</h4>\n<p>It seems likely matchmaking is underrated, at least relative to dating apps and for those who can afford the fees? Or it would be, if the services deliver the goods.</p>\n<p>I\u2019ve now seen several ads on the subway recently for matchmaking services. The latest was for a service called Tawkify, which claims to be rather large, and I figured I\u2019d do some brief investigation.</p>\n<p>Clients pay for a package of curated dates managed by a dedicated matchmaker, based on your criteria, or you can pay a much smaller amount ($100/year) to be the candidate pool. They will also recruit outside the platform.</p>\n<p>Yes, the price of ~$4500 for three matches is not cheap (bigger packages seem cheaper per date), but compare it to the number of hours you would otherwise spend to get to that point, and the quality of the matches you get from the apps, and ask if you were enjoying those hours of app work.</p>\n<p>The problem with the matchmaking option is what you would expect it to be. The service is reportedly using predatory sales tactics and does not actually make much of an attempt to Do The Thing.</p>\n<p>Yes, you would expect a lot of unhappy complaining customers no matter how good the service was but even by that standard this look is terrible and there are a lot of signs of reputation manipulation.</p>\n<blockquote><p>Google Deep Research: A stark contradiction exists between the company&#8217;s heavily promoted high rating on Trustpilot and the extensive volume of severe complaints lodged with the Better Business Bureau (BBB) and on public forums like Reddit. A pattern of recurring complaints alleges misleading sales tactics, poor match quality that disregards client-stated preferences, high matchmaker turnover, and the enforcement of rigid, non-refundable contracts that place the full financial burden on the consumer.</p>\n<p>\u2026</p>\n<p>One detailed complaint from a client who paid $4,500 articulated the perceived unfairness of being matched with men who had only paid the $99 database fee, a critical detail she claims was never disclosed during the sales process.</p>\n<p>\u2026</p>\n<p><strong>Step 1: Initial Screening &amp; Sales Call.</strong> The process begins when a prospective client completes an online application, which vets for basic criteria such as age, location, and income. If the applicant is deemed a potential fit, they are scheduled for a call with a &#8220;client experience specialist&#8221; or salesperson. This initial call is a critical juncture and a source of numerous consumer complaints.</p>\n<p>Multiple reports filed with the BBB and on public forums describe this as a high-pressure sales call where key, and often deal-breaking, details of the service\u2014such as the mandatory blind date format or the strict non-refundable policy\u2014are allegedly omitted, downplayed, or obscured. Some prospective customers have reported being chastised or emotionally manipulated when they balked at the high price point.</p>\n<p>\u2026</p>\n<p>When a matchmaker does make contact, the screening process is explicitly one-way. The interview and vetting are conducted to determine the individual&#8217;s suitability for a specific paying Client. The Member&#8217;s or Recruit&#8217;s preferences are secondary; the primary objective is to find someone who meets the Client&#8217;s criteria.</p></blockquote>\n<p>So the trick is to find the good version of the service.</p>\n<p>Also, it seems there is now at least one person running a <a href=\"https://www.intuitiveintimacy.co/\" rel=\"noopener noreferrer nofollow\" target=\"_blank\">non-monogamous matchmaking servic</a>e focusing on Austin, Oakland and Boulder.</p>"
            ],
            "link": "https://thezvi.wordpress.com/2025/09/01/dating-roundup-7-back-to-basics/",
            "publishedAt": "2025-09-01",
            "source": "TheZvi",
            "summary": "There\u2019s quite a lot in the queue since last time, so this is the first large chunk of it, which focuses on apps and otherwise finding an initial connection, and some things that directly impact that. Table of Contents You\u2019re &#8230; <a href=\"https://thezvi.wordpress.com/2025/09/01/dating-roundup-7-back-to-basics/\">Continue reading <span class=\"meta-nav\">&#8594;</span></a>",
            "title": "Dating Roundup #7: Back to Basics"
        },
        {
            "content": [],
            "link": "https://xkcd.com/3136/",
            "publishedAt": "2025-09-01",
            "source": "XKCD",
            "summary": "<img alt=\"Be careful fighting gravity. If you win, it's a long way down.\" src=\"https://imgs.xkcd.com/comics/pull.png\" title=\"Be careful fighting gravity. If you win, it's a long way down.\" />",
            "title": "Pull"
        }
    ],
    "lookbackDays": 1,
    "publishDate": "2025-09-01"
}